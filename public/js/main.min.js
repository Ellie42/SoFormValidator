function soFormValidator(e){var r=sofova.domHelper.getElementFromVarious(e),t=new sofova.formConfigurator,n={};return n.validate=sofova.validator(r,t),n.$$parent=r,n.config=t,sofova.forms.push(n),n}!function(){function e(e,t){var o=e[t];e[t]=function(e){var t,i=!1,a=!1;if(e.match(n)){e=e.replace(n,""),this.parentNode||(r.appendChild(this),a=!0);var l=this.parentNode;return this.id||(this.id="rootedQuerySelector_id_"+(new Date).getTime(),i=!0),t=o.call(l,"#"+this.id+" "+e),i&&(this.id=""),a&&r.removeChild(this),t}return o.call(this,e)}}if(!HTMLElement.prototype.querySelectorAll)throw new Error("rootedQuerySelectorAll: This polyfill can only be used with browsers that support querySelectorAll");var r=document.createElement("div");try{r.querySelectorAll(":scope *")}catch(t){var n=/^\s*:scope/gi;e(HTMLElement.prototype,"querySelector"),e(HTMLElement.prototype,"querySelectorAll")}}(),function(e){"use strict";var r=e.prototype,t=r.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(n){}r.parseFromString=function(e,r){if(/^\s*text\/html\s*(?:;|$)/i.test(r)){var n=document.implementation.createHTMLDocument("");return e.toLowerCase().indexOf("<!doctype")>-1?n.documentElement.innerHTML=e:n.body.innerHTML=e,n}return t.apply(this,arguments)}}(DOMParser);var sofova={forms:[]};sofova.validators=function(e){function r(e,t,n){var o=t[e[0]];if("undefined"!=typeof n)var i=n[e[0]];return 1===e.length?i||o:"string"!=typeof o?r(e.slice(1),o,i):o}function t(t,n){if("undefined"!=typeof t){var o=t.split("."),i=sofova.validators.$$messages,a=e.$$customMessages,l=r(o,i,a),s=l.replace(/\$(.*?)\$/g,function(e){return n[e.slice(1,e.length-1)]});return[s,t]}}function n(e,r){if(isNaN(e))return NaN;var t="undefined"==typeof r.min||e>=r.min,n="undefined"==typeof r.max||e<=r.max;return t?n?0:1:-1}function o(e,r,t){if("undefined"!=typeof i[r]){var n=i[r](e,t);return"undefined"==typeof n?!0:{text:n[0],code:n[1]}}return new Error("Validator does not exist")}var i={required:function(e,r){return e===!0&&r.length<=0?t("required",e):void 0},length:function(e,r){var o,i=n(r.length,e);return-1===i&&(o="length.low"),1===i&&(o="length.high"),t(o,e)},value:function(e,r){r=parseFloat(r);var o,i=n(r,e);return-1===i&&(o="value.low"),1===i&&(o="value.high"),isNaN(i)&&(o="value.nan"),t(o,e)}};return{run:o}},sofova.validators.$$messages={length:{low:"Minimum length is $min$",high:"Maximum length is $max$"},value:{low:"Minimum value is $min$",high:"Maximum value is $max$",nan:"Value must be a number between $min$ and $max$"},required:"Value is required"},sofova.domHelper=function(){function e(e){return"object"==typeof e||Array.isArray(e)?e:"string"==typeof e?document.querySelectorAll(e):null}return{getElementFromVarious:e}}(),sofova.formConfigurator=function(){function e(e){for(var r in e)this.$$templateConfig[r]=e[r]}function r(e){this.$$customMessages=e}function t(e,r){return"undefined"==typeof this.$$rules[e]&&(this.$$rules[e]={}),this.$$rules[e].config=r,this}function n(e){for(var r=Object.keys(this.$$rules),t=0;t<r.length;t++)if("$$"!==r[t].slice(0,2)){var n=this.$$rules[r[t]];e(n,r[t])}}var o={type:"default",template:'<div class="so-form-errors">$element$ $errors$</div>',errorTemplate:'<div class="so-form-error">$message$</div>'};return{$$rules:{},$$templateConfig:o,$$iterateRules:n,template:e,errorMessages:r,rule:t}},sofova.validator=function(e,r){function t(e,r){for(var t=[],n=Object.keys(e),o=0;o<n.length;o++){var i=l.run(e[n[o]],n[o],r);i!==!0&&t.push({name:n[o],message:i})}return t}function n(e,n){for(var o=[],i=0;i<n.length;i++){var a=t(e.config,n[i].value);a.length>0?(o[i]=a,sofova.errorRenderer.displayErrors(n[i],e,a,r.$$templateConfig)):sofova.errorRenderer.clearErrors(r.$$templateConfig,n[i])}return o}function o(e){}function i(){l=sofova.validators(r);for(var t=0;t<e.length;t++)var n=e[t],o=a(n);return o}function a(e){var t={};return r.$$iterateRules(function(r,o){var i=e.querySelectorAll(":scope "+o),a=n(r,i);a.length>0&&(t[o]=a)}),t}var l={};return{all:i,form:o}},sofova.errorRenderer=function(){function e(e,r){var t;return t=r.reduce(function(r,t){var n=e.errorTemplate.replace("$message$",t.message.text).replace("$code$",t.message.code);return r+n},"")}function r(e){if("undefined"!=typeof e)for(var r=0;r<e.length;r++)e[r].remove()}function t(e,r){var r=e.details.parent.insertBefore(r,e.details.parent.children[e.details.index]),t=r.style.display;return r.style.display="none",r.style.display=t,r}function n(e,r){for(var n=[];"undefined"!=typeof e[e.length-1];){var o=t(r,e[e.length-1]);n.push(o)}r.elements=n}function o(t,o,i){r(t.elements);var a=t.template;a=a.replace("$element$","<element-placeholder></element-placeholder>").replace("$errors$",e(t,i));var l=new DOMParser,s=l.parseFromString(a,"text/html").firstChild.childNodes[1],u=s.children,f=s.querySelector("element-placeholder");f.parentElement.insertBefore(o,f),n(u,t),f.remove()}function i(e,n){"undefined"!=typeof e.details&&(r(e.elements),n.remove(),t(e,n))}function a(e,r,t,n){"undefined"==typeof n.details&&(n.details={parent:e.parentElement,index:Array.prototype.indexOf.call(e.parentElement,e)}),o(n,e,t)}return{displayErrors:a,clearErrors:i}}();var form=soFormValidator(".test-form");form.config.rule("input[name=test-input]",{value:{max:10,min:5},length:{min:1},required:!0}),form.config.errorMessages({value:{low:"Low low low",high:"High high high"},required:"Ooooooops"}),form.config.template({template:"<div class='so-form-errors'>$element$ $errors$</div>",errorTemplate:"<div class='so-form-error' data-code='$code$'>$message$</div>"});var formB=soFormValidator(".test-form-b");formB.config.rule("input[name=test-input]",{value:{max:10},length:{min:1},required:!0}),document.querySelector("input[type=submit]").addEventListener("mouseup",function(){form.validate.all()}),console.log(form),console.log();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNvLWZvcm0tdmFsaWRhdG9yLmpzIiwic2NvcGVkUXVlcnlTZWxlY3RvclNoaW0uanMiLCJkb21QYXJzZXIuanMiLCJib290c3RyYXAuanMiLCJ2YWxpZGF0b3JzLmpzIiwibWVzc2FnZXMuanMiLCJkb20taGVscGVyLmpzIiwiZm9ybS1jb25maWd1cmF0b3IuanMiLCJ2YWxpZGF0b3IuanMiLCJlcnJvci1yZW5kZXJlci5qcyIsIm1haW4uanMiXSwibmFtZXMiOlsic29Gb3JtVmFsaWRhdG9yIiwiZm9ybUVsZW1lbnQiLCJmb3JtRWxlbWVudHMiLCJzb2ZvdmEiLCJkb21IZWxwZXIiLCJnZXRFbGVtZW50RnJvbVZhcmlvdXMiLCJjb25maWd1cmF0b3IiLCJmb3JtQ29uZmlndXJhdG9yIiwibmV3Rm9ybSIsInZhbGlkYXRlIiwidmFsaWRhdG9yIiwiJCRwYXJlbnQiLCJjb25maWciLCJmb3JtcyIsInB1c2giLCJvdmVycmlkZU5vZGVNZXRob2QiLCJwcm90b3R5cGUiLCJtZXRob2ROYW1lIiwib2xkTWV0aG9kIiwicXVlcnkiLCJub2RlTGlzdCIsImdhdmVJZCIsImdhdmVDb250YWluZXIiLCJtYXRjaCIsInNjb3BlUkUiLCJyZXBsYWNlIiwidGhpcyIsInBhcmVudE5vZGUiLCJjb250YWluZXIiLCJhcHBlbmRDaGlsZCIsImlkIiwiRGF0ZSIsImdldFRpbWUiLCJjYWxsIiwicmVtb3ZlQ2hpbGQiLCJIVE1MRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJFcnJvciIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImUiLCJET01QYXJzZXIiLCJwcm90byIsIm5hdGl2ZVBhcnNlIiwicGFyc2VGcm9tU3RyaW5nIiwiZXgiLCJtYXJrdXAiLCJ0eXBlIiwidGVzdCIsImRvYyIsImltcGxlbWVudGF0aW9uIiwiY3JlYXRlSFRNTERvY3VtZW50IiwidG9Mb3dlckNhc2UiLCJpbmRleE9mIiwiZG9jdW1lbnRFbGVtZW50IiwiaW5uZXJIVE1MIiwiYm9keSIsImFwcGx5IiwiYXJndW1lbnRzIiwidmFsaWRhdG9ycyIsImdldE1lc3NhZ2VGcm9tQ29uZmlnIiwic3BsaXRDb2RlIiwibWVzc2FnZXMiLCJjdXN0b21NZXNzYWdlcyIsInZhbHVlVG9DaGVjayIsImN1c3RvbVZhbHVlVG9DaGVjayIsImxlbmd0aCIsInNsaWNlIiwibWVzc2FnZSIsImNvZGUiLCJzcGxpdCIsIiQkbWVzc2FnZXMiLCIkJGN1c3RvbU1lc3NhZ2VzIiwicG9wdWxhdGVkTWVzc2FnZSIsImEiLCJpblJhbmdlIiwidmFsIiwiaXNOYU4iLCJOYU4iLCJtaW5DaGVjayIsIm1pbiIsIm1heENoZWNrIiwibWF4IiwicnVuVmFsaWRhdG9yIiwibmFtZSIsInZhbHVlIiwiZXJyIiwidGV4dCIsInJlcXVpcmVkIiwicmVzdWx0IiwicGFyc2VGbG9hdCIsInJ1biIsImxvdyIsImhpZ2giLCJuYW4iLCJlbGVtZW50IiwiQXJyYXkiLCJpc0FycmF5IiwidGVtcGxhdGUiLCJhdHRyTmFtZSIsIiQkdGVtcGxhdGVDb25maWciLCJlcnJvck1lc3NhZ2VzIiwiYWRkUnVsZSIsInNlbGVjdG9yIiwiJCRydWxlcyIsIml0ZXJhdGVSdWxlcyIsImZ1bmMiLCJrZXlzIiwiT2JqZWN0IiwiaSIsImN1clJ1bGUiLCJ0ZW1wbGF0ZURlZmF1bHRzIiwiZXJyb3JUZW1wbGF0ZSIsIiQkaXRlcmF0ZVJ1bGVzIiwicnVsZSIsInJ1blZhbGlkYXRpb24iLCJlcnJvcnMiLCJ2YWxpZGF0ZUVsZW1lbnRzIiwiZWxlbWVudHMiLCJyZXN1bHRzIiwiZXJyb3JSZW5kZXJlciIsImRpc3BsYXlFcnJvcnMiLCJjbGVhckVycm9ycyIsInZhbGlkYXRlRm9ybSIsImZvcm1OYW1lIiwidmFsaWRhdGVBbGwiLCJqIiwidmFsaWRhdGVFbGVtZW50c0luRm9ybSIsImFsbCIsImZvcm0iLCJnZXRFcnJvcnNTdHJpbmciLCJ0ZW1wbGF0ZUNvbmZpZyIsInN0cmluZyIsInJlZHVjZSIsIm9sZCIsIm5ld1ZhbCIsIm5ld1RleHQiLCJyZW1vdmVPbGRFbGVtZW50cyIsInJlbW92ZSIsInJlcGxhY2VEb21FbGVtZW50IiwiZGV0YWlscyIsInBhcmVudCIsImluc2VydEJlZm9yZSIsImNoaWxkcmVuIiwiaW5kZXgiLCJvbGREaXNwbGF5Iiwic3R5bGUiLCJkaXNwbGF5IiwiYWRkRWxlbWVudHNUb0RvbSIsInRlbXBsYXRlRWxlbWVudHMiLCJuZXdFbGVtZW50cyIsIm5ld0VsZW1lbnQiLCJwb3B1bGF0ZUVycm9yRWxlbWVudCIsInRlbXBsYXRlU3RyaW5nIiwiZG9tUGFyc2VyIiwidGVtcGxhdGVQYXJlbnQiLCJmaXJzdENoaWxkIiwiY2hpbGROb2RlcyIsImVsZW1lbnRQbGFjZWhvbGRlciIsInF1ZXJ5U2VsZWN0b3IiLCJwYXJlbnRFbGVtZW50IiwiZm9ybUIiLCJhZGRFdmVudExpc3RlbmVyIiwiY29uc29sZSIsImxvZyJdLCJtYXBwaW5ncyI6IkFBT0EsUUFBQUEsaUJBQUFDLEdBQ0EsR0FBQUMsR0FBQUMsT0FBQUMsVUFBQUMsc0JBQUFKLEdBQ0FLLEVBQUEsR0FBQUgsUUFBQUksaUJBRUFDLElBU0EsT0FQQUEsR0FBQUMsU0FBQU4sT0FBQU8sVUFBQVIsRUFBQUksR0FFQUUsRUFBQUcsU0FBQVQsRUFDQU0sRUFBQUksT0FBQU4sRUFFQUgsT0FBQVUsTUFBQUMsS0FBQU4sR0FFQUEsR0NwQkEsV0FtQkEsUUFBQU8sR0FBQUMsRUFBQUMsR0FFQSxHQUFBQyxHQUFBRixFQUFBQyxFQUdBRCxHQUFBQyxHQUFBLFNBQUFFLEdBQ0EsR0FBQUMsR0FDQUMsR0FBQSxFQUNBQyxHQUFBLENBRUEsSUFBQUgsRUFBQUksTUFBQUMsR0FBQSxDQUVBTCxFQUFBQSxFQUFBTSxRQUFBRCxFQUFBLElBRUFFLEtBQUFDLGFBRUFDLEVBQUFDLFlBQUFILE1BQ0FKLEdBQUEsRUFHQSxJQUFBSyxHQUFBRCxLQUFBQyxVQXFCQSxPQW5CQUQsTUFBQUksS0FFQUosS0FBQUksR0FBQSwyQkFBQSxHQUFBQyxPQUFBQyxVQUNBWCxHQUFBLEdBSUFELEVBQUFGLEVBQUFlLEtBQUFOLEVBQUEsSUFBQUQsS0FBQUksR0FBQSxJQUFBWCxHQUdBRSxJQUNBSyxLQUFBSSxHQUFBLElBSUFSLEdBQ0FNLEVBQUFNLFlBQUFSLE1BR0FOLEVBSUEsTUFBQUYsR0FBQWUsS0FBQVAsS0FBQVAsSUEvREEsSUFBQWdCLFlBQUFuQixVQUFBb0IsaUJBQ0EsS0FBQSxJQUFBQyxPQUFBLHFHQUtBLElBQUFULEdBQUFVLFNBQUFDLGNBQUEsTUFHQSxLQUVBWCxFQUFBUSxpQkFBQSxZQUVBLE1BQUFJLEdBRUEsR0FBQWhCLEdBQUEsY0FzREFULEdBQUFvQixZQUFBbkIsVUFBQSxpQkFDQUQsRUFBQW9CLFlBQUFuQixVQUFBLHdCQ3ZFQSxTQUFBeUIsR0FDQSxZQUVBLElBQ0FDLEdBQUFELEVBQUF6QixVQUNBMkIsRUFBQUQsRUFBQUUsZUFJQSxLQUVBLElBQUEsR0FBQUgsSUFBQUcsZ0JBQUEsR0FBQSxhQUVBLE9BRUEsTUFBQUMsSUFHQUgsRUFBQUUsZ0JBQUEsU0FBQUUsRUFBQUMsR0FDQSxHQUFBLDRCQUFBQyxLQUFBRCxHQUFBLENBQ0EsR0FDQUUsR0FBQVgsU0FBQVksZUFBQUMsbUJBQUEsR0FRQSxPQU5BTCxHQUFBTSxjQUFBQyxRQUFBLGFBQUEsR0FDQUosRUFBQUssZ0JBQUFDLFVBQUFULEVBR0FHLEVBQUFPLEtBQUFELFVBQUFULEVBRUFHLEVBRUEsTUFBQU4sR0FBQWMsTUFBQS9CLEtBQUFnQyxhQUdBakIsVUNsQ0EsSUFBQXRDLFNBQ0FVLFNDREFWLFFBQUF3RCxXQUFBLFNBQUFyRCxHQU9BLFFBQUFzRCxHQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFDLEdBQUFGLEVBQUFELEVBQUEsR0FDQSxJQUFBLG1CQUFBRSxHQUNBLEdBQUFFLEdBQUFGLEVBQUFGLEVBQUEsR0FHQSxPQUFBLEtBQUFBLEVBQUFLLE9BQ0FELEdBQUFELEVBR0EsZ0JBQUFBLEdBQ0FKLEVBQUFDLEVBQUFNLE1BQUEsR0FBQUgsRUFBQUMsR0FHQUQsRUFNQSxRQUFBSSxHQUFBQyxFQUFBekQsR0FDQSxHQUFBLG1CQUFBeUQsR0FBQSxDQUlBLEdBQUFSLEdBQUFRLEVBQUFDLE1BQUEsS0FDQVIsRUFBQTNELE9BQUF3RCxXQUFBWSxXQUNBUixFQUFBekQsRUFBQWtFLGlCQUVBSixFQUFBUixFQUFBQyxFQUFBQyxFQUFBQyxHQUdBVSxFQUFBTCxFQUFBM0MsUUFBQSxhQUFBLFNBQUFpRCxHQUNBLE1BQUE5RCxHQUFBOEQsRUFBQVAsTUFBQSxFQUFBTyxFQUFBUixPQUFBLEtBR0EsUUFBQU8sRUFBQUosSUFTQSxRQUFBTSxHQUFBQyxFQUFBaEUsR0FDQSxHQUFBaUUsTUFBQUQsR0FDQSxNQUFBRSxJQUdBLElBQUFDLEdBQUEsbUJBQUFuRSxHQUFBb0UsS0FBQUosR0FBQWhFLEVBQUFvRSxJQUNBQyxFQUFBLG1CQUFBckUsR0FBQXNFLEtBQUFOLEdBQUFoRSxFQUFBc0UsR0FFQSxPQUFBSCxHQUdBRSxFQUlBLEVBSEEsRUFIQSxHQXdEQSxRQUFBRSxHQUFBdkUsRUFBQXdFLEVBQUFDLEdBQ0EsR0FBQSxtQkFBQTFCLEdBQUF5QixHQUFBLENBQ0EsR0FBQUUsR0FBQTNCLEVBQUF5QixHQUFBeEUsRUFBQXlFLEVBQ0EsT0FBQSxtQkFBQUMsSUFDQSxHQUVBQyxLQUFBRCxFQUFBLEdBQUFqQixLQUFBaUIsRUFBQSxJQUdBLE1BQUEsSUFBQWpELE9BQUEsNEJBcERBLEdBQUFzQixJQUNBNkIsU0FBQSxTQUFBNUUsRUFBQWdFLEdBQ0EsTUFBQWhFLE1BQUEsR0FBQWdFLEVBQUFWLFFBQUEsRUFDQUUsRUFBQSxXQUFBeEQsR0FEQSxRQUlBc0QsT0FBQSxTQUFBdEQsRUFBQWdFLEdBQ0EsR0FBQVAsR0FBQW9CLEVBQUFkLEVBQUFDLEVBQUFWLE9BQUF0RCxFQVNBLE9BUEEsS0FBQTZFLElBQ0FwQixFQUFBLGNBRUEsSUFBQW9CLElBQ0FwQixFQUFBLGVBR0FELEVBQUFDLEVBQUF6RCxJQUVBeUUsTUFBQSxTQUFBekUsRUFBQWdFLEdBQ0FBLEVBQUFjLFdBQUFkLEVBQ0EsSUFBQVAsR0FBQW9CLEVBQUFkLEVBQUFDLEVBQUFoRSxFQVlBLE9BVkEsS0FBQTZFLElBQ0FwQixFQUFBLGFBRUEsSUFBQW9CLElBQ0FwQixFQUFBLGNBRUFRLE1BQUFZLEtBQ0FwQixFQUFBLGFBR0FELEVBQUFDLEVBQUF6RCxJQXVCQSxRQUNBK0UsSUFBQVIsSUNsSUFoRixPQUFBd0QsV0FBQVksWUFDQUwsUUFDQTBCLElBQUEsMEJBQ0FDLEtBQUEsMkJBRUFSLE9BQ0FPLElBQUEseUJBQ0FDLEtBQUEseUJBQ0FDLElBQUEsa0RBRUFOLFNBQUEscUJDVkFyRixPQUFBQyxVQUFBLFdBS0EsUUFBQUMsR0FBQTBGLEdBQ0EsTUFBQSxnQkFBQUEsSUFBQUMsTUFBQUMsUUFBQUYsR0FDQUEsRUFHQSxnQkFBQUEsR0FDQXpELFNBQUFGLGlCQUFBMkQsR0FHQSxLQUdBLE9BQ0ExRixzQkFBQUEsTUNsQkFGLE9BQUFJLGlCQUFBLFdBS0EsUUFBQTJGLEdBQUF0RixHQUNBLElBQUEsR0FBQXVGLEtBQUF2RixHQUNBYyxLQUFBMEUsaUJBQUFELEdBQUF2RixFQUFBdUYsR0FRQSxRQUFBRSxHQUFBekYsR0FDQWMsS0FBQThDLGlCQUFBNUQsRUFRQSxRQUFBMEYsR0FBQUMsRUFBQTNGLEdBT0EsTUFOQSxtQkFBQWMsTUFBQThFLFFBQUFELEtBQ0E3RSxLQUFBOEUsUUFBQUQsT0FHQTdFLEtBQUE4RSxRQUFBRCxHQUFBM0YsT0FBQUEsRUFFQWMsS0FPQSxRQUFBK0UsR0FBQUMsR0FHQSxJQUFBLEdBRkFDLEdBQUFDLE9BQUFELEtBQUFqRixLQUFBOEUsU0FFQUssRUFBQSxFQUFBQSxFQUFBRixFQUFBekMsT0FBQTJDLElBQ0EsR0FBQSxPQUFBRixFQUFBRSxHQUFBMUMsTUFBQSxFQUFBLEdBQUEsQ0FHQSxHQUFBMkMsR0FBQXBGLEtBQUE4RSxRQUFBRyxFQUFBRSxHQUVBSCxHQUFBSSxFQUFBSCxFQUFBRSxLQUlBLEdBQUFFLElBQ0FoRSxLQUFBLFVBQ0FtRCxTQUFBLHVEQUNBYyxjQUFBLDZDQUdBLFFBQ0FSLFdBQ0FKLGlCQUFBVyxFQUNBRSxlQUFBUixFQUNBUCxTQUFBQSxFQUNBRyxjQUFBQSxFQUNBYSxLQUFBWixJQy9EQW5HLE9BQUFPLFVBQUEsU0FBQVIsRUFBQUksR0FRQSxRQUFBNkcsR0FBQXZHLEVBQUF5RSxHQUlBLElBQUEsR0FIQStCLE1BRUFULEVBQUFDLE9BQUFELEtBQUEvRixHQUNBaUcsRUFBQSxFQUFBQSxFQUFBRixFQUFBekMsT0FBQTJDLElBQUEsQ0FDQSxHQUFBcEIsR0FBQTlCLEVBQUFnQyxJQUFBL0UsRUFBQStGLEVBQUFFLElBQUFGLEVBQUFFLEdBQUF4QixFQUNBSSxNQUFBLEdBQ0EyQixFQUFBdEcsTUFDQXNFLEtBQUF1QixFQUFBRSxHQUNBekMsUUFBQXFCLElBS0EsTUFBQTJCLEdBUUEsUUFBQUMsR0FBQUgsRUFBQUksR0FHQSxJQUFBLEdBRkFDLE1BRUFWLEVBQUEsRUFBQUEsRUFBQVMsRUFBQXBELE9BQUEyQyxJQUFBLENBQ0EsR0FBQU8sR0FBQUQsRUFBQUQsRUFBQXRHLE9BQUEwRyxFQUFBVCxHQUFBeEIsTUFDQStCLEdBQUFsRCxPQUFBLEdBQ0FxRCxFQUFBVixHQUFBTyxFQUNBakgsT0FBQXFILGNBQUFDLGNBQUFILEVBQUFULEdBQUFLLEVBQUFFLEVBQUE5RyxFQUFBOEYsbUJBRUFqRyxPQUFBcUgsY0FBQUUsWUFBQXBILEVBQUE4RixpQkFBQWtCLEVBQUFULElBSUEsTUFBQVUsR0FHQSxRQUFBSSxHQUFBQyxJQU1BLFFBQUFDLEtBQ0FsRSxFQUFBeEQsT0FBQXdELFdBQUFyRCxFQUVBLEtBQUEsR0FBQXdILEdBQUEsRUFBQUEsRUFBQTVILEVBQUFnRSxPQUFBNEQsSUFDQSxHQUFBN0gsR0FBQUMsRUFBQTRILEdBQ0FQLEVBQUFRLEVBQUE5SCxFQUdBLE9BQUFzSCxHQUdBLFFBQUFRLEdBQUE5SCxHQUNBLEdBQUFzSCxLQWFBLE9BWEFqSCxHQUFBMkcsZUFBQSxTQUFBQyxFQUFBWCxHQUVBLEdBQUFlLEdBQUFySCxFQUFBbUMsaUJBQUEsVUFBQW1FLEdBRUFhLEVBQUFDLEVBQUFILEVBQUFJLEVBRUFGLEdBQUFsRCxPQUFBLElBQ0FxRCxFQUFBaEIsR0FBQWEsS0FJQUcsRUE1RUEsR0FBQTVELEtBK0VBLFFBQ0FxRSxJQUFBSCxFQUNBSSxLQUFBTixJQ2xGQXhILE9BQUFxSCxjQUFBLFdBT0EsUUFBQVUsR0FBQUMsRUFBQWYsR0FDQSxHQUFBZ0IsRUFVQSxPQVJBQSxHQUFBaEIsRUFBQWlCLE9BQUEsU0FBQUMsRUFBQUMsR0FDQSxHQUFBQyxHQUFBTCxFQUFBbkIsY0FDQXZGLFFBQUEsWUFBQThHLEVBQUFuRSxRQUFBbUIsTUFDQTlELFFBQUEsU0FBQThHLEVBQUFuRSxRQUFBQyxLQUVBLE9BQUFpRSxHQUFBRSxHQUNBLElBU0EsUUFBQUMsR0FBQW5CLEdBQ0EsR0FBQSxtQkFBQUEsR0FJQSxJQUFBLEdBQUFULEdBQUEsRUFBQUEsRUFBQVMsRUFBQXBELE9BQUEyQyxJQUNBUyxFQUFBVCxHQUFBNkIsU0FJQSxRQUFBQyxHQUFBUixFQUFBcEMsR0FDQSxHQUFBQSxHQUFBb0MsRUFBQVMsUUFBQUMsT0FDQUMsYUFDQS9DLEVBQ0FvQyxFQUFBUyxRQUFBQyxPQUFBRSxTQUFBWixFQUFBUyxRQUFBSSxRQUdBQyxFQUFBbEQsRUFBQW1ELE1BQUFDLE9BS0EsT0FIQXBELEdBQUFtRCxNQUFBQyxRQUFBLE9BQ0FwRCxFQUFBbUQsTUFBQUMsUUFBQUYsRUFFQWxELEVBU0EsUUFBQXFELEdBQUFDLEVBQUFsQixHQUdBLElBRkEsR0FBQW1CLE1BRUEsbUJBQUFELEdBQUFBLEVBQUFuRixPQUFBLElBQUEsQ0FDQSxHQUFBcUYsR0FDQVosRUFDQVIsRUFDQWtCLEVBQUFBLEVBQUFuRixPQUFBLEdBR0FvRixHQUFBeEksS0FBQXlJLEdBR0FwQixFQUFBYixTQUFBZ0MsRUFTQSxRQUFBRSxHQUFBckIsRUFBQXBDLEVBQUFxQixHQUNBcUIsRUFBQU4sRUFBQWIsU0FFQSxJQUFBbUMsR0FBQXRCLEVBQUFqQyxRQUVBdUQsR0FBQUEsRUFDQWhJLFFBQUEsWUFBQSwrQ0FDQUEsUUFBQSxXQUFBeUcsRUFBQUMsRUFBQWYsR0FFQSxJQUFBc0MsR0FBQSxHQUFBakgsV0FDQWtILEVBQUFELEVBQUE5RyxnQkFBQTZHLEVBQUEsYUFDQUcsV0FBQUMsV0FBQSxHQUVBUixFQUFBTSxFQUFBWixTQUVBZSxFQUFBSCxFQUFBSSxjQUFBLHNCQUVBRCxHQUFBRSxjQUFBbEIsYUFBQS9DLEVBQUErRCxHQUVBVixFQUFBQyxFQUFBbEIsR0FFQTJCLEVBQUFwQixTQU1BLFFBQUFoQixHQUFBUyxFQUFBcEMsR0FDQSxtQkFBQW9DLEdBQUFTLFVBSUFILEVBQUFOLEVBQUFiLFVBQ0F2QixFQUFBMkMsU0FDQUMsRUFBQVIsRUFBQXBDLElBVUEsUUFBQTBCLEdBQUExQixFQUFBbUIsRUFBQUUsRUFBQWUsR0FFQSxtQkFBQUEsR0FBQVMsVUFDQVQsRUFBQVMsU0FDQUMsT0FBQTlDLEVBQUFpRSxjQUNBaEIsTUFBQWhELE1BQUFoRixVQUFBcUMsUUFBQXBCLEtBQUE4RCxFQUFBaUUsY0FBQWpFLEtBSUF5RCxFQUFBckIsRUFBQXBDLEVBQUFxQixHQUdBLE9BQ0FLLGNBQUFBLEVBQ0FDLFlBQUFBLEtDeElBLElBQUFPLE1BQUFqSSxnQkFBQSxhQUVBaUksTUFBQXJILE9BQUFzRyxLQUFBLDBCQUNBN0IsT0FDQUgsSUFBQSxHQUNBRixJQUFBLEdBRUFkLFFBQ0FjLElBQUEsR0FFQVEsVUFBQSxJQUdBeUMsS0FBQXJILE9BQUF5RixlQUNBaEIsT0FDQU8sSUFBQSxjQUNBQyxLQUFBLGtCQUVBTCxTQUFBLGNBR0F5QyxLQUFBckgsT0FBQXNGLFVBQ0FBLFNBQUEsdURBQ0FjLGNBQUEsaUVBR0EsSUFBQWlELE9BQUFqSyxnQkFBQSxlQUVBaUssT0FBQXJKLE9BQUFzRyxLQUFBLDBCQUNBN0IsT0FDQUgsSUFBQSxJQUVBaEIsUUFDQWMsSUFBQSxHQUVBUSxVQUFBLElBR0FsRCxTQUFBeUgsY0FBQSxzQkFBQUcsaUJBQUEsVUFBQSxXQUNBakMsS0FBQXhILFNBQUF1SCxRQUdBbUMsUUFBQUMsSUFBQW5DLE1BQ0FrQyxRQUFBQyIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWRkcyBmb3JtIHZhbGlkYXRpb24gdG8gY2hpbGRyZW4gb2YgZ2l2ZW4gZG9tIGVsZW1lbnRcbiAqXG4gKiBSZXF1aXJlcyBhIGRvbSBlbGVtZW50IG9iamVjdCBvciBhIHN0cmluZyBjbGFzcyBvciBpZCBzZWxlY3Rvci5cbiAqIEBwYXJhbSB7Tm9kZSB8IHN0cmluZyB8IE5vZGVMaXN0IHwgQXJyYXkgPHN0cmluZz59IGZvcm1FbGVtZW50XG4gKiBAcmV0dXJucyB7e319XG4gKi9cbmZ1bmN0aW9uIHNvRm9ybVZhbGlkYXRvcihmb3JtRWxlbWVudCkge1xuICAgIHZhciBmb3JtRWxlbWVudHMgPSBzb2ZvdmEuZG9tSGVscGVyLmdldEVsZW1lbnRGcm9tVmFyaW91cyhmb3JtRWxlbWVudCk7XG4gICAgdmFyIGNvbmZpZ3VyYXRvciA9IG5ldyBzb2ZvdmEuZm9ybUNvbmZpZ3VyYXRvcigpO1xuXG4gICAgdmFyIG5ld0Zvcm0gPSB7fTtcblxuICAgIG5ld0Zvcm0udmFsaWRhdGUgPSBzb2ZvdmEudmFsaWRhdG9yKGZvcm1FbGVtZW50cywgY29uZmlndXJhdG9yKTtcblxuICAgIG5ld0Zvcm0uJCRwYXJlbnQgPSBmb3JtRWxlbWVudHM7XG4gICAgbmV3Rm9ybS5jb25maWcgPSBjb25maWd1cmF0b3I7XG5cbiAgICBzb2ZvdmEuZm9ybXMucHVzaChuZXdGb3JtKTtcblxuICAgIHJldHVybiBuZXdGb3JtO1xufSIsIihmdW5jdGlvbigpIHtcbiAgICBpZiAoIUhUTUxFbGVtZW50LnByb3RvdHlwZS5xdWVyeVNlbGVjdG9yQWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcigncm9vdGVkUXVlcnlTZWxlY3RvckFsbDogVGhpcyBwb2x5ZmlsbCBjYW4gb25seSBiZSB1c2VkIHdpdGggYnJvd3NlcnMgdGhhdCBzdXBwb3J0IHF1ZXJ5U2VsZWN0b3JBbGwnKTtcbiAgICB9XG5cbiAgICAvLyBBIHRlbXBvcmFyeSBlbGVtZW50IHRvIHF1ZXJ5IGFnYWluc3QgZm9yIGVsZW1lbnRzIG5vdCBjdXJyZW50bHkgaW4gdGhlIERPTVxuICAgIC8vIFdlJ2xsIGFsc28gdXNlIHRoaXMgZWxlbWVudCB0byB0ZXN0IGZvciA6c2NvcGUgc3VwcG9ydFxuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICAgIC8vIENoZWNrIGlmIHRoZSBicm93c2VyIHN1cHBvcnRzIDpzY29wZVxuICAgIHRyeSB7XG4gICAgICAgIC8vIEJyb3dzZXIgc3VwcG9ydHMgOnNjb3BlLCBkbyBub3RoaW5nXG4gICAgICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCc6c2NvcGUgKicpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICAvLyBNYXRjaCB1c2FnZSBvZiBzY29wZVxuICAgICAgICB2YXIgc2NvcGVSRSA9IC9eXFxzKjpzY29wZS9naTtcblxuICAgICAgICAvLyBPdmVycmlkZXNcbiAgICAgICAgZnVuY3Rpb24gb3ZlcnJpZGVOb2RlTWV0aG9kKHByb3RvdHlwZSwgbWV0aG9kTmFtZSkge1xuICAgICAgICAgICAgLy8gU3RvcmUgdGhlIG9sZCBtZXRob2QgZm9yIHVzZSBsYXRlclxuICAgICAgICAgICAgdmFyIG9sZE1ldGhvZCA9IHByb3RvdHlwZVttZXRob2ROYW1lXTtcblxuICAgICAgICAgICAgLy8gT3ZlcnJpZGUgdGhlIG1ldGhvZFxuICAgICAgICAgICAgcHJvdG90eXBlW21ldGhvZE5hbWVdID0gZnVuY3Rpb24ocXVlcnkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbm9kZUxpc3QsXG4gICAgICAgICAgICAgICAgICAgIGdhdmVJZCA9IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBnYXZlQ29udGFpbmVyID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAocXVlcnkubWF0Y2goc2NvcGVSRSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIDpzY29wZVxuICAgICAgICAgICAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LnJlcGxhY2Uoc2NvcGVSRSwgJycpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdG8gdGVtcG9yYXJ5IGNvbnRhaW5lclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2F2ZUNvbnRhaW5lciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50Tm9kZSA9IHRoaXMucGFyZW50Tm9kZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdpdmUgdGVtcG9yYXJ5IElEXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlkID0gJ3Jvb3RlZFF1ZXJ5U2VsZWN0b3JfaWRfJysobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2F2ZUlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIEZpbmQgZWxlbWVudHMgYWdhaW5zdCBwYXJlbnQgbm9kZVxuICAgICAgICAgICAgICAgICAgICBub2RlTGlzdCA9IG9sZE1ldGhvZC5jYWxsKHBhcmVudE5vZGUsICcjJyt0aGlzLmlkKycgJytxdWVyeSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgdGhlIElEXG4gICAgICAgICAgICAgICAgICAgIGlmIChnYXZlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaWQgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBmcm9tIHRlbXBvcmFyeSBjb250YWluZXJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdhdmVDb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlTGlzdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE5vIGltbWVkaWF0ZSBjaGlsZCBzZWxlY3RvciB1c2VkXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvbGRNZXRob2QuY2FsbCh0aGlzLCBxdWVyeSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IDpzY29wZSwgYWRkIHBvbHlmaWxsXG4gICAgICAgIG92ZXJyaWRlTm9kZU1ldGhvZChIVE1MRWxlbWVudC5wcm90b3R5cGUsICdxdWVyeVNlbGVjdG9yJyk7XG4gICAgICAgIG92ZXJyaWRlTm9kZU1ldGhvZChIVE1MRWxlbWVudC5wcm90b3R5cGUsICdxdWVyeVNlbGVjdG9yQWxsJyk7XG4gICAgfVxufSgpKTsiLCIoZnVuY3Rpb24gKERPTVBhcnNlcikge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgdmFyXG4gICAgICAgIHByb3RvID0gRE9NUGFyc2VyLnByb3RvdHlwZVxuICAgICAgICAsIG5hdGl2ZVBhcnNlID0gcHJvdG8ucGFyc2VGcm9tU3RyaW5nXG4gICAgICAgIDtcblxuICAgIC8vIEZpcmVmb3gvT3BlcmEvSUUgdGhyb3cgZXJyb3JzIG9uIHVuc3VwcG9ydGVkIHR5cGVzXG4gICAgdHJ5IHtcbiAgICAgICAgLy8gV2ViS2l0IHJldHVybnMgbnVsbCBvbiB1bnN1cHBvcnRlZCB0eXBlc1xuICAgICAgICBpZiAoKG5ldyBET01QYXJzZXIoKSkucGFyc2VGcm9tU3RyaW5nKFwiXCIsIFwidGV4dC9odG1sXCIpKSB7XG4gICAgICAgICAgICAvLyB0ZXh0L2h0bWwgcGFyc2luZyBpcyBuYXRpdmVseSBzdXBwb3J0ZWRcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgfVxuXG4gICAgcHJvdG8ucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKG1hcmt1cCwgdHlwZSkge1xuICAgICAgICBpZiAoL15cXHMqdGV4dFxcL2h0bWxcXHMqKD86O3wkKS9pLnRlc3QodHlwZSkpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgIGRvYyA9IGRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZUhUTUxEb2N1bWVudChcIlwiKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmIChtYXJrdXAudG9Mb3dlckNhc2UoKS5pbmRleE9mKCc8IWRvY3R5cGUnKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgZG9jLmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUwgPSBtYXJrdXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBkb2MuYm9keS5pbm5lckhUTUwgPSBtYXJrdXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZG9jO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5hdGl2ZVBhcnNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICB9O1xufShET01QYXJzZXIpKTsiLCJ2YXIgc29mb3ZhID0ge1xuICAgIGZvcm1zOiBbXVxufTtcbiIsInNvZm92YS52YWxpZGF0b3JzID0gKGZ1bmN0aW9uIChjb25maWd1cmF0b3IpIHtcbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBhIG1lc3NhZ2UgZnJvbSB0aGUgZGVmYXVsdCBjb25maWdcbiAgICAgKiBAcGFyYW0gc3BsaXRDb2RlXG4gICAgICogQHBhcmFtIGFycmF5XG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0TWVzc2FnZUZyb21Db25maWcoc3BsaXRDb2RlLCBtZXNzYWdlcywgY3VzdG9tTWVzc2FnZXMpIHtcbiAgICAgICAgdmFyIHZhbHVlVG9DaGVjayA9IG1lc3NhZ2VzW3NwbGl0Q29kZVswXV07XG4gICAgICAgIGlmICh0eXBlb2YgY3VzdG9tTWVzc2FnZXMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB2YXIgY3VzdG9tVmFsdWVUb0NoZWNrID0gY3VzdG9tTWVzc2FnZXNbc3BsaXRDb2RlWzBdXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzcGxpdENvZGUubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICByZXR1cm4gY3VzdG9tVmFsdWVUb0NoZWNrIHx8IHZhbHVlVG9DaGVjaztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWVUb0NoZWNrICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIGdldE1lc3NhZ2VGcm9tQ29uZmlnKHNwbGl0Q29kZS5zbGljZSgxKSwgdmFsdWVUb0NoZWNrLCBjdXN0b21WYWx1ZVRvQ2hlY2spO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbHVlVG9DaGVjaztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gYW4gZXJyb3IgbWVzc2FnZSBmcm9tIGVycm9yIGNvZGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBtZXNzYWdlKGNvZGUsIGNvbmZpZykge1xuICAgICAgICBpZiAodHlwZW9mIGNvZGUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc3BsaXRDb2RlID0gY29kZS5zcGxpdChcIi5cIik7XG4gICAgICAgIHZhciBtZXNzYWdlcyA9IHNvZm92YS52YWxpZGF0b3JzLiQkbWVzc2FnZXM7XG4gICAgICAgIHZhciBjdXN0b21NZXNzYWdlcyA9IGNvbmZpZ3VyYXRvci4kJGN1c3RvbU1lc3NhZ2VzO1xuXG4gICAgICAgIHZhciBtZXNzYWdlID0gZ2V0TWVzc2FnZUZyb21Db25maWcoc3BsaXRDb2RlLCBtZXNzYWdlcywgY3VzdG9tTWVzc2FnZXMpO1xuXG4gICAgICAgIC8vUmVwbGFjZSBhbnkgcGxhY2Vob2xkZXJzIGluIHRoZSB0ZXh0IHdpdGggdmFsdWVzIGluIHRoZSBjb25maWdcbiAgICAgICAgdmFyIHBvcHVsYXRlZE1lc3NhZ2UgPSBtZXNzYWdlLnJlcGxhY2UoL1xcJCguKj8pXFwkL2csIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnW2Euc2xpY2UoMSwgYS5sZW5ndGggLSAxKV07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBbcG9wdWxhdGVkTWVzc2FnZSwgY29kZV07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIGEgdmFsdWUgaXMgaW4gYSBjZXJ0YWluIHJhbmdlIGFuZCByZXR1cm5zIC0xIGlmIHRvbyBsb3cgMSBpZiB0b28gaGlnaCBhbmQgMCBpZiBpbiByYW5nZVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2YWxcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gY29uZmlnXG4gICAgICogQHJldHVybnMge2ludH1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpblJhbmdlKHZhbCwgY29uZmlnKSB7XG4gICAgICAgIGlmIChpc05hTih2YWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG1pbkNoZWNrID0gKHR5cGVvZiBjb25maWcubWluID09PSBcInVuZGVmaW5lZFwiIHx8IHZhbCA+PSBjb25maWcubWluKTtcbiAgICAgICAgdmFyIG1heENoZWNrID0gKHR5cGVvZiBjb25maWcubWF4ID09PSBcInVuZGVmaW5lZFwiIHx8IHZhbCA8PSBjb25maWcubWF4KTtcblxuICAgICAgICBpZiAoIW1pbkNoZWNrKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFtYXhDaGVjaykge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb2xsZWN0aW9uIG9mIGFsbCB2YWxpZGF0b3IgZnVuY3Rpb25zXG4gICAgICogQHR5cGUge3tyZXF1aXJlZDogdmFsaWRhdG9ycy5yZXF1aXJlZCwgbGVuZ3RoOiB2YWxpZGF0b3JzLmxlbmd0aH19XG4gICAgICovXG4gICAgdmFyIHZhbGlkYXRvcnMgPSB7XG4gICAgICAgIHJlcXVpcmVkOiBmdW5jdGlvbiAoY29uZmlnLCB2YWwpIHtcbiAgICAgICAgICAgIGlmIChjb25maWcgPT09IHRydWUgJiYgdmFsLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2UoJ3JlcXVpcmVkJywgY29uZmlnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgbGVuZ3RoOiBmdW5jdGlvbiAoY29uZmlnLCB2YWwpIHtcbiAgICAgICAgICAgIHZhciBjb2RlLCByZXN1bHQgPSBpblJhbmdlKHZhbC5sZW5ndGgsIGNvbmZpZyk7XG5cbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgY29kZSA9IFwibGVuZ3RoLmxvd1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGNvZGUgPSBcImxlbmd0aC5oaWdoXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlKGNvZGUsIGNvbmZpZyk7XG4gICAgICAgIH0sXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoY29uZmlnLCB2YWwpIHtcbiAgICAgICAgICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcbiAgICAgICAgICAgIHZhciBjb2RlLCByZXN1bHQgPSBpblJhbmdlKHZhbCwgY29uZmlnKTtcblxuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICBjb2RlID0gXCJ2YWx1ZS5sb3dcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjb2RlID0gXCJ2YWx1ZS5oaWdoXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNOYU4ocmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIGNvZGUgPSBcInZhbHVlLm5hblwiXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlKGNvZGUsIGNvbmZpZyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUnVuIHZhbGlkYXRpb24gZnVuY3Rpb24gb24gYSB2YWx1ZVxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBjb25maWdcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICAgICAqIEBwYXJhbSB2YWx1ZVxuICAgICAqIEByZXR1cm4ge2Jvb2xlYW4gfCBFcnJvciB8IG9iamVjdH1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBydW5WYWxpZGF0b3IoY29uZmlnLCBuYW1lLCB2YWx1ZSkge1xuICAgICAgICBpZiAodHlwZW9mIHZhbGlkYXRvcnNbbmFtZV0gIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIHZhciBlcnIgPSB2YWxpZGF0b3JzW25hbWVdKGNvbmZpZywgdmFsdWUpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBlcnIgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7dGV4dDogZXJyWzBdLCBjb2RlOiBlcnJbMV19O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBFcnJvcihcIlZhbGlkYXRvciBkb2VzIG5vdCBleGlzdFwiKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBydW46IHJ1blZhbGlkYXRvclxuICAgIH07XG59KTsiLCJzb2ZvdmEudmFsaWRhdG9ycy4kJG1lc3NhZ2VzID0ge1xuICAgIGxlbmd0aDoge1xuICAgICAgICBsb3c6IFwiTWluaW11bSBsZW5ndGggaXMgJG1pbiRcIixcbiAgICAgICAgaGlnaDogXCJNYXhpbXVtIGxlbmd0aCBpcyAkbWF4JFwiXG4gICAgfSxcbiAgICB2YWx1ZToge1xuICAgICAgICBsb3c6IFwiTWluaW11bSB2YWx1ZSBpcyAkbWluJFwiLFxuICAgICAgICBoaWdoOiBcIk1heGltdW0gdmFsdWUgaXMgJG1heCRcIixcbiAgICAgICAgbmFuOiBcIlZhbHVlIG11c3QgYmUgYSBudW1iZXIgYmV0d2VlbiAkbWluJCBhbmQgJG1heCRcIlxuICAgIH0sXG4gICAgcmVxdWlyZWQ6IFwiVmFsdWUgaXMgcmVxdWlyZWRcIlxufTsiLCJzb2ZvdmEuZG9tSGVscGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0RvbUVsZW1lbnQgfCBzdHJpbmcgfCBBcnJheSA8RG9tRWxlbWVudD4gfCBBcnJheSA8c3RyaW5nPn0gZWxlbWVudFxuICAgICAqIEByZXR1cm5zIHtEb21FbGVtZW50IHwgQXJyYXkgPERvbUVsZW1lbnQ+fVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldEVsZW1lbnRGcm9tVmFyaW91cyhlbGVtZW50KSB7XG4gICAgICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gXCJvYmplY3RcIiB8fCBBcnJheS5pc0FycmF5KGVsZW1lbnQpKSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXRFbGVtZW50RnJvbVZhcmlvdXM6IGdldEVsZW1lbnRGcm9tVmFyaW91c1xuICAgIH07XG59KCkpOyIsInNvZm92YS5mb3JtQ29uZmlndXJhdG9yID0gZnVuY3Rpb24gKCkge1xuICAgIC8qKlxuICAgICAqIFNldCB0aGUgdGVtcGxhdGUgb3B0aW9uc1xuICAgICAqIEBwYXJhbSBjb25maWdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0ZW1wbGF0ZShjb25maWcpIHtcbiAgICAgICAgZm9yICh2YXIgYXR0ck5hbWUgaW4gY29uZmlnKSB7XG4gICAgICAgICAgICB0aGlzLiQkdGVtcGxhdGVDb25maWdbYXR0ck5hbWVdID0gY29uZmlnW2F0dHJOYW1lXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHVwIGN1c3RvbSBlcnJvciBtZXNzYWdlc1xuICAgICAqIEBwYXJhbSBjb25maWdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBlcnJvck1lc3NhZ2VzKGNvbmZpZykge1xuICAgICAgICB0aGlzLiQkY3VzdG9tTWVzc2FnZXMgPSBjb25maWc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGEgdmFsaWRhdGlvbiBydWxlIHRvIGEgZm9ybSBlbGVtZW50XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGNvbmZpZ1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFkZFJ1bGUoc2VsZWN0b3IsIGNvbmZpZykge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMuJCRydWxlc1tzZWxlY3Rvcl0gPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIHRoaXMuJCRydWxlc1tzZWxlY3Rvcl0gPSB7fTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuJCRydWxlc1tzZWxlY3Rvcl0uY29uZmlnID0gY29uZmlnO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvb3AgdGhyb3VnaCBhbGwgcnVsZXMgYW5kIGNhbGxiYWNrIG9uIGVhY2hcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmdW5jXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXRlcmF0ZVJ1bGVzKGZ1bmMpIHtcbiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLiQkcnVsZXMpO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGtleXNbaV0uc2xpY2UoMCwgMikgPT09IFwiJCRcIikge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGN1clJ1bGUgPSB0aGlzLiQkcnVsZXNba2V5c1tpXV07XG5cbiAgICAgICAgICAgIGZ1bmMoY3VyUnVsZSwga2V5c1tpXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgdGVtcGxhdGVEZWZhdWx0cyA9IHtcbiAgICAgICAgdHlwZTogXCJkZWZhdWx0XCIsXG4gICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInNvLWZvcm0tZXJyb3JzXCI+JGVsZW1lbnQkICRlcnJvcnMkPC9kaXY+JyxcbiAgICAgICAgZXJyb3JUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJzby1mb3JtLWVycm9yXCI+JG1lc3NhZ2UkPC9kaXY+J1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICAkJHJ1bGVzOiB7fSxcbiAgICAgICAgJCR0ZW1wbGF0ZUNvbmZpZzogdGVtcGxhdGVEZWZhdWx0cyxcbiAgICAgICAgJCRpdGVyYXRlUnVsZXM6IGl0ZXJhdGVSdWxlcyxcbiAgICAgICAgdGVtcGxhdGU6IHRlbXBsYXRlLFxuICAgICAgICBlcnJvck1lc3NhZ2VzOiBlcnJvck1lc3NhZ2VzLFxuICAgICAgICBydWxlOiBhZGRSdWxlXG4gICAgfTtcbn07Iiwic29mb3ZhLnZhbGlkYXRvciA9IChmdW5jdGlvbiAoZm9ybUVsZW1lbnRzLCBjb25maWd1cmF0b3IpIHtcbiAgICB2YXIgdmFsaWRhdG9ycyA9IHt9O1xuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGUgYSB2YWx1ZSBhZ2FpbnN0IGEgdmFsaWRhdGlvbiBjb25maWdcbiAgICAgKiBAcGFyYW0gY29uZmlnXG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICovXG4gICAgZnVuY3Rpb24gcnVuVmFsaWRhdGlvbihjb25maWcsIHZhbHVlKSB7XG4gICAgICAgIHZhciBlcnJvcnMgPSBbXTtcblxuICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGNvbmZpZyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHZhbGlkYXRvcnMucnVuKGNvbmZpZ1trZXlzW2ldXSwga2V5c1tpXSwgdmFsdWUpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZToga2V5c1tpXSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogcmVzdWx0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZXJyb3JzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJ1biB2YWxpZGF0b3IgZnVuY3Rpb24gb24gYWxsIGVsZW1lbnRzXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHJ1bGVcbiAgICAgKiBAcGFyYW0ge05vZGVMaXN0fSBlbGVtZW50c1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHZhbGlkYXRlRWxlbWVudHMocnVsZSwgZWxlbWVudHMpIHtcbiAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgZXJyb3JzID0gcnVuVmFsaWRhdGlvbihydWxlLmNvbmZpZywgZWxlbWVudHNbaV0udmFsdWUpO1xuICAgICAgICAgICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0c1tpXSA9IGVycm9ycztcbiAgICAgICAgICAgICAgICBzb2ZvdmEuZXJyb3JSZW5kZXJlci5kaXNwbGF5RXJyb3JzKGVsZW1lbnRzW2ldLCBydWxlLCBlcnJvcnMsIGNvbmZpZ3VyYXRvci4kJHRlbXBsYXRlQ29uZmlnKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzb2ZvdmEuZXJyb3JSZW5kZXJlci5jbGVhckVycm9ycyhjb25maWd1cmF0b3IuJCR0ZW1wbGF0ZUNvbmZpZywgZWxlbWVudHNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdmFsaWRhdGVGb3JtKGZvcm1OYW1lKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGUgYWxsIGZpZWxkcyBpbiBmb3JtXG4gICAgICovXG4gICAgZnVuY3Rpb24gdmFsaWRhdGVBbGwoKSB7XG4gICAgICAgIHZhbGlkYXRvcnMgPSBzb2ZvdmEudmFsaWRhdG9ycyhjb25maWd1cmF0b3IpO1xuXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZm9ybUVsZW1lbnRzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICB2YXIgZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudHNbal07XG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IHZhbGlkYXRlRWxlbWVudHNJbkZvcm0oZm9ybUVsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdmFsaWRhdGVFbGVtZW50c0luRm9ybShmb3JtRWxlbWVudCkge1xuICAgICAgICB2YXIgcmVzdWx0cyA9IHt9O1xuXG4gICAgICAgIGNvbmZpZ3VyYXRvci4kJGl0ZXJhdGVSdWxlcyhmdW5jdGlvbiAocnVsZSwgc2VsZWN0b3IpIHtcbiAgICAgICAgICAgIC8vbm9pbnNwZWN0aW9uIEpTUmVmZXJlbmNpbmdNdXRhYmxlVmFyaWFibGVGcm9tQ2xvc3VyZVxuICAgICAgICAgICAgdmFyIGVsZW1lbnRzID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcIjpzY29wZSBcIiArIHNlbGVjdG9yKTtcblxuICAgICAgICAgICAgdmFyIGVycm9ycyA9IHZhbGlkYXRlRWxlbWVudHMocnVsZSwgZWxlbWVudHMpO1xuXG4gICAgICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXN1bHRzW3NlbGVjdG9yXSA9IGVycm9ycztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgYWxsOiB2YWxpZGF0ZUFsbCxcbiAgICAgICAgZm9ybTogdmFsaWRhdGVGb3JtXG4gICAgfTtcbn0pOyIsInNvZm92YS5lcnJvclJlbmRlcmVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIERPTSBlbGVtZW50IHRoYXQgZGlzcGxheSBlcnJvciBtZXNzYWdlc1xuICAgICAqIEBwYXJhbSB0ZW1wbGF0ZUNvbmZpZ1xuICAgICAqIEBwYXJhbSB7QXJyYXl9IGVycm9yc1xuICAgICAqIEByZXR1cm4ge3N0cmluZ31cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRFcnJvcnNTdHJpbmcodGVtcGxhdGVDb25maWcsIGVycm9ycykge1xuICAgICAgICB2YXIgc3RyaW5nO1xuXG4gICAgICAgIHN0cmluZyA9IGVycm9ycy5yZWR1Y2UoZnVuY3Rpb24gKG9sZCwgbmV3VmFsKSB7XG4gICAgICAgICAgICB2YXIgbmV3VGV4dCA9IHRlbXBsYXRlQ29uZmlnLmVycm9yVGVtcGxhdGVcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIiRtZXNzYWdlJFwiLCBuZXdWYWwubWVzc2FnZS50ZXh0KVxuICAgICAgICAgICAgICAgIC5yZXBsYWNlKFwiJGNvZGUkXCIsIG5ld1ZhbC5tZXNzYWdlLmNvZGUpO1xuXG4gICAgICAgICAgICByZXR1cm4gb2xkICsgbmV3VGV4dDtcbiAgICAgICAgfSwgXCJcIik7XG5cbiAgICAgICAgcmV0dXJuIHN0cmluZztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgb2xkIGVycm9yIG1lc3NhZ2UgZWxlbWVudHNcbiAgICAgKiBAcGFyYW0gZWxlbWVudHNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZW1vdmVPbGRFbGVtZW50cyhlbGVtZW50cykge1xuICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnRzID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZWxlbWVudHNbaV0ucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZXBsYWNlRG9tRWxlbWVudCh0ZW1wbGF0ZUNvbmZpZywgZWxlbWVudCkge1xuICAgICAgICB2YXIgZWxlbWVudCA9IHRlbXBsYXRlQ29uZmlnLmRldGFpbHMucGFyZW50XG4gICAgICAgICAgICAuaW5zZXJ0QmVmb3JlKFxuICAgICAgICAgICAgICAgIGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVDb25maWcuZGV0YWlscy5wYXJlbnQuY2hpbGRyZW5bdGVtcGxhdGVDb25maWcuZGV0YWlscy5pbmRleF1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgdmFyIG9sZERpc3BsYXkgPSBlbGVtZW50LnN0eWxlLmRpc3BsYXk7XG5cbiAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBvbGREaXNwbGF5O1xuXG4gICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCBhbGwgdGhlIHRlbXBsYXRlIGVsZW1lbnRzIHRvIHRoZSBET00gdXNpbmcgdGhlIHRlbXBsYXRlQ29uZmlnLmRldGFpbHNcbiAgICAgKiBhcyBhIHJlZmVyZW5jZVxuICAgICAqIEBwYXJhbSB0ZW1wbGF0ZUVsZW1lbnRzXG4gICAgICogQHBhcmFtIHRlbXBsYXRlQ29uZmlnXG4gICAgICovXG4gICAgZnVuY3Rpb24gYWRkRWxlbWVudHNUb0RvbSh0ZW1wbGF0ZUVsZW1lbnRzLCB0ZW1wbGF0ZUNvbmZpZykge1xuICAgICAgICB2YXIgbmV3RWxlbWVudHMgPSBbXTtcblxuICAgICAgICB3aGlsZSAodHlwZW9mIHRlbXBsYXRlRWxlbWVudHNbdGVtcGxhdGVFbGVtZW50cy5sZW5ndGggLSAxXSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHZhciBuZXdFbGVtZW50ID1cbiAgICAgICAgICAgICAgICByZXBsYWNlRG9tRWxlbWVudChcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVDb25maWcsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlRWxlbWVudHNbdGVtcGxhdGVFbGVtZW50cy5sZW5ndGggLSAxXVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIG5ld0VsZW1lbnRzLnB1c2gobmV3RWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICB0ZW1wbGF0ZUNvbmZpZy5lbGVtZW50cyA9IG5ld0VsZW1lbnRzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFBvcHVsYXRlIHRoZSB0ZW1wbGF0ZSB3aXRoIGVycm9yIG1lc3NhZ2VzIHVzaW5nIHRoZSBwbGFjZWhvbGRlcnNcbiAgICAgKiBAcGFyYW0gdGVtcGxhdGVDb25maWdcbiAgICAgKiBAcGFyYW0gZWxlbWVudFxuICAgICAqIEBwYXJhbSBlcnJvcnNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBwb3B1bGF0ZUVycm9yRWxlbWVudCh0ZW1wbGF0ZUNvbmZpZywgZWxlbWVudCwgZXJyb3JzKSB7XG4gICAgICAgIHJlbW92ZU9sZEVsZW1lbnRzKHRlbXBsYXRlQ29uZmlnLmVsZW1lbnRzKTtcblxuICAgICAgICB2YXIgdGVtcGxhdGVTdHJpbmcgPSB0ZW1wbGF0ZUNvbmZpZy50ZW1wbGF0ZTtcblxuICAgICAgICB0ZW1wbGF0ZVN0cmluZyA9IHRlbXBsYXRlU3RyaW5nXG4gICAgICAgICAgICAucmVwbGFjZShcIiRlbGVtZW50JFwiLCBcIjxlbGVtZW50LXBsYWNlaG9sZGVyPjwvZWxlbWVudC1wbGFjZWhvbGRlcj5cIilcbiAgICAgICAgICAgIC5yZXBsYWNlKFwiJGVycm9ycyRcIiwgZ2V0RXJyb3JzU3RyaW5nKHRlbXBsYXRlQ29uZmlnLCBlcnJvcnMpKTtcblxuICAgICAgICB2YXIgZG9tUGFyc2VyID0gbmV3IERPTVBhcnNlcigpO1xuICAgICAgICB2YXIgdGVtcGxhdGVQYXJlbnQgPSBkb21QYXJzZXIucGFyc2VGcm9tU3RyaW5nKHRlbXBsYXRlU3RyaW5nLCBcInRleHQvaHRtbFwiKVxuICAgICAgICAgICAgLmZpcnN0Q2hpbGQuY2hpbGROb2Rlc1sxXTtcblxuICAgICAgICB2YXIgdGVtcGxhdGVFbGVtZW50cyA9IHRlbXBsYXRlUGFyZW50LmNoaWxkcmVuO1xuXG4gICAgICAgIHZhciBlbGVtZW50UGxhY2Vob2xkZXIgPSB0ZW1wbGF0ZVBhcmVudC5xdWVyeVNlbGVjdG9yKFwiZWxlbWVudC1wbGFjZWhvbGRlclwiKTtcblxuICAgICAgICBlbGVtZW50UGxhY2Vob2xkZXIucGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoZWxlbWVudCwgZWxlbWVudFBsYWNlaG9sZGVyKTtcblxuICAgICAgICBhZGRFbGVtZW50c1RvRG9tKHRlbXBsYXRlRWxlbWVudHMsIHRlbXBsYXRlQ29uZmlnKTtcblxuICAgICAgICBlbGVtZW50UGxhY2Vob2xkZXIucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIEVycm9yIGVsZW1lbnRzXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xlYXJFcnJvcnModGVtcGxhdGVDb25maWcsIGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0ZW1wbGF0ZUNvbmZpZy5kZXRhaWxzID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVtb3ZlT2xkRWxlbWVudHModGVtcGxhdGVDb25maWcuZWxlbWVudHMpO1xuICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICByZXBsYWNlRG9tRWxlbWVudCh0ZW1wbGF0ZUNvbmZpZywgZWxlbWVudCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGVycm9yIGVsZW1lbnQgYW5kIHBvcHVsYXRlXG4gICAgICogQHBhcmFtIGVsZW1lbnRcbiAgICAgKiBAcGFyYW0gcnVsZVxuICAgICAqIEBwYXJhbSBlcnJvcnNcbiAgICAgKiBAcGFyYW0gdGVtcGxhdGVDb25maWdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkaXNwbGF5RXJyb3JzKGVsZW1lbnQsIHJ1bGUsIGVycm9ycywgdGVtcGxhdGVDb25maWcpIHtcbiAgICAgICAgLy9JZiBpdCdzIHRoZSBmaXJzdCB0aW1lIHRoZW4gc2F2ZSB0aGUgcG9zaXRpb24gZGV0YWlscyBzbyB3ZSBjYW4gcHV0IHRoZSBpbnB1dCBiYWNrXG4gICAgICAgIGlmICh0eXBlb2YgdGVtcGxhdGVDb25maWcuZGV0YWlscyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRlbXBsYXRlQ29uZmlnLmRldGFpbHMgPSB7XG4gICAgICAgICAgICAgICAgcGFyZW50OiBlbGVtZW50LnBhcmVudEVsZW1lbnQsXG4gICAgICAgICAgICAgICAgaW5kZXg6IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoZWxlbWVudC5wYXJlbnRFbGVtZW50LCBlbGVtZW50KVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHBvcHVsYXRlRXJyb3JFbGVtZW50KHRlbXBsYXRlQ29uZmlnLCBlbGVtZW50LCBlcnJvcnMpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGRpc3BsYXlFcnJvcnM6IGRpc3BsYXlFcnJvcnMsXG4gICAgICAgIGNsZWFyRXJyb3JzOiBjbGVhckVycm9yc1xuICAgIH07XG59KCkpOyIsInZhciBmb3JtID0gc29Gb3JtVmFsaWRhdG9yKFwiLnRlc3QtZm9ybVwiKTtcblxuZm9ybS5jb25maWcucnVsZShcImlucHV0W25hbWU9dGVzdC1pbnB1dF1cIiwge1xuICAgIHZhbHVlOiB7XG4gICAgICAgIG1heDogMTAsXG4gICAgICAgIG1pbjogNVxuICAgIH0sXG4gICAgbGVuZ3RoOiB7XG4gICAgICAgIG1pbjogMVxuICAgIH0sXG4gICAgcmVxdWlyZWQ6IHRydWVcbn0pO1xuXG5mb3JtLmNvbmZpZy5lcnJvck1lc3NhZ2VzKHtcbiAgICB2YWx1ZToge1xuICAgICAgICBsb3c6IFwiTG93IGxvdyBsb3dcIixcbiAgICAgICAgaGlnaDogXCJIaWdoIGhpZ2ggaGlnaFwiXG4gICAgfSxcbiAgICByZXF1aXJlZDogXCJPb29vb29vcHNcIlxufSk7XG5cbmZvcm0uY29uZmlnLnRlbXBsYXRlKHtcbiAgICB0ZW1wbGF0ZTogXCI8ZGl2IGNsYXNzPSdzby1mb3JtLWVycm9ycyc+JGVsZW1lbnQkICRlcnJvcnMkPC9kaXY+XCIsXG4gICAgZXJyb3JUZW1wbGF0ZTogXCI8ZGl2IGNsYXNzPSdzby1mb3JtLWVycm9yJyBkYXRhLWNvZGU9JyRjb2RlJCc+JG1lc3NhZ2UkPC9kaXY+XCJcbn0pO1xuXG52YXIgZm9ybUIgPSBzb0Zvcm1WYWxpZGF0b3IoXCIudGVzdC1mb3JtLWJcIik7XG5cbmZvcm1CLmNvbmZpZy5ydWxlKFwiaW5wdXRbbmFtZT10ZXN0LWlucHV0XVwiLCB7XG4gICAgdmFsdWU6IHtcbiAgICAgICAgbWF4OiAxMFxuICAgIH0sXG4gICAgbGVuZ3RoOiB7XG4gICAgICAgIG1pbjogMVxuICAgIH0sXG4gICAgcmVxdWlyZWQ6IHRydWVcbn0pO1xuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbdHlwZT1zdWJtaXRdXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBmb3JtLnZhbGlkYXRlLmFsbCgpO1xufSk7XG5cbmNvbnNvbGUubG9nKGZvcm0pO1xuY29uc29sZS5sb2coKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
