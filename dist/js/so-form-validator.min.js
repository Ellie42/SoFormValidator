function soFormValidator(e){var r=sofova.domHelper.getElementFromVarious(e),t=new sofova.formConfigurator,n={};return n.validate=sofova.validator(r,t),n.$$parent=r,n.config=t,sofova.forms.push(n),n}!function(){function e(e,t){var o=e[t];e[t]=function(e){var t,i=!1,a=!1;if(e.match(n)){e=e.replace(n,""),this.parentNode||(r.appendChild(this),a=!0);var l=this.parentNode;return this.id||(this.id="rootedQuerySelector_id_"+(new Date).getTime(),i=!0),t=o.call(l,"#"+this.id+" "+e),i&&(this.id=""),a&&r.removeChild(this),t}return o.call(this,e)}}if(!HTMLElement.prototype.querySelectorAll)throw new Error("rootedQuerySelectorAll: This polyfill can only be used with browsers that support querySelectorAll");var r=document.createElement("div");try{r.querySelectorAll(":scope *")}catch(t){var n=/^\s*:scope/gi;e(HTMLElement.prototype,"querySelector"),e(HTMLElement.prototype,"querySelectorAll")}}(),function(e){"use strict";var r=e.prototype,t=r.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(n){}r.parseFromString=function(e,r){if(/^\s*text\/html\s*(?:;|$)/i.test(r)){var n=document.implementation.createHTMLDocument("");return e.toLowerCase().indexOf("<!doctype")>-1?n.documentElement.innerHTML=e:n.body.innerHTML=e,n}return t.apply(this,arguments)}}(DOMParser);var sofova={forms:[]};sofova.validators=function(e){function r(e,t,n){var o=t[e[0]];if("undefined"!=typeof n)var i=n[e[0]];return 1===e.length?i||o:"string"!=typeof o?r(e.slice(1),o,i):o}function t(t,n){if("undefined"!=typeof t){var o=t.split("."),i=sofova.validators.$$messages,a=e.$$customMessages,l=r(o,i,a),s=l.replace(/\$(.*?)\$/g,function(e){return n[e.slice(1,e.length-1)]});return[s,t]}}function n(e,r){if(isNaN(e))return NaN;var t="undefined"==typeof r.min||e>=r.min,n="undefined"==typeof r.max||e<=r.max;return t?n?0:1:-1}function o(e,r,t){if("undefined"!=typeof i[r]){var n=i[r](e,t);return"undefined"==typeof n?!0:{text:n[0],code:n[1]}}return new Error("Validator does not exist")}var i={required:function(e,r){return e===!0&&r.length<=0?t("required",e):void 0},length:function(e,r){var o,i=n(r.length,e);return-1===i&&(o="length.low"),1===i&&(o="length.high"),t(o,e)},value:function(e,r){r=parseFloat(r);var o,i=n(r,e);return-1===i&&(o="value.low"),1===i&&(o="value.high"),isNaN(i)&&(o="value.nan"),t(o,e)}};return{run:o}},sofova.validators.$$messages={length:{low:"Minimum length is $min$",high:"Maximum length is $max$"},value:{low:"Minimum value is $min$",high:"Maximum value is $max$",nan:"Value must be a number between $min$ and $max$"},required:"Value is required"},sofova.domHelper=function(){function e(e){return"object"==typeof e||Array.isArray(e)?e:"string"==typeof e?document.querySelectorAll(e):null}return{getElementFromVarious:e}}(),sofova.formConfigurator=function(){function e(e){for(var r in e)this.$$templateConfig[r]=e[r]}function r(e){this.$$customMessages=e}function t(e,r){return"undefined"==typeof this.$$rules[e]&&(this.$$rules[e]={}),this.$$rules[e].config=r,this}function n(e){for(var r=Object.keys(this.$$rules),t=0;t<r.length;t++)if("$$"!==r[t].slice(0,2)){var n=this.$$rules[r[t]];e(n,r[t])}}var o={type:"default",template:'<div class="so-form-errors">$element$ $errors$</div>',errorTemplate:'<div class="so-form-error">$message$</div>'};return{$$rules:{},$$templateConfig:o,$$iterateRules:n,template:e,errorMessages:r,rule:t}},sofova.validator=function(e,r){function t(e,r){for(var t=[],n=Object.keys(e),o=0;o<n.length;o++){var i=l.run(e[n[o]],n[o],r);i!==!0&&t.push({name:n[o],message:i})}return t}function n(e,n){for(var o=[],i=0;i<n.length;i++){var a=t(e.config,n[i].value);a.length>0?(o[i]=a,sofova.errorRenderer.displayErrors(n[i],e,a,r.$$templateConfig)):sofova.errorRenderer.clearErrors(r.$$templateConfig,n[i])}return o}function o(e){}function i(){l=sofova.validators(r);for(var t=0;t<e.length;t++)var n=e[t],o=a(n);return o}function a(e){var t={};return r.$$iterateRules(function(r,o){var i=e.querySelectorAll(":scope "+o),a=n(r,i);a.length>0&&(t[o]=a)}),t}var l={};return{all:i,form:o}},sofova.errorRenderer=function(){function e(e,r){var t;return t=r.reduce(function(r,t){var n=e.errorTemplate.replace("$message$",t.message.text).replace("$code$",t.message.code);return r+n},"")}function r(e){if("undefined"!=typeof e)for(var r=0;r<e.length;r++)e[r].remove()}function t(e,r){var r=e.details.parent.insertBefore(r,e.details.parent.children[e.details.index]),t=r.style.display;return r.style.display="none",r.style.display=t,r}function n(e,r){for(var n=[];"undefined"!=typeof e[e.length-1];){var o=t(r,e[e.length-1]);n.push(o)}r.elements=n}function o(t,o,i){r(t.elements);var a=t.template;a=a.replace("$element$","<element-placeholder></element-placeholder>").replace("$errors$",e(t,i));var l=new DOMParser,s=l.parseFromString(a,"text/html").firstChild.childNodes[1],u=s.children,f=s.querySelector("element-placeholder");f.parentElement.insertBefore(o,f),n(u,t),f.remove()}function i(e,n){"undefined"!=typeof e.details&&(r(e.elements),n.remove(),t(e,n))}function a(e,r,t,n){"undefined"==typeof n.details&&(n.details={parent:e.parentElement,index:Array.prototype.indexOf.call(e.parentElement,e)}),o(n,e,t)}return{displayErrors:a,clearErrors:i}}();var form=soFormValidator(".test-form");form.config.rule("input[name=test-input]",{value:{max:10,min:5},length:{min:1},required:!0}),form.config.errorMessages({value:{low:"Low low low",high:"High high high"},required:"Ooooooops"}),form.config.template({template:"<div class='so-form-errors'>$element$ $errors$</div>",errorTemplate:"<div class='so-form-error' data-code='$code$'>$message$</div>"});var formB=soFormValidator(".test-form-b");formB.config.rule("input[name=test-input]",{value:{max:10},length:{min:1},required:!0}),document.querySelector("input[type=submit]").addEventListener("mouseup",function(){form.validate.all()}),console.log(form),console.log();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNvLWZvcm0tdmFsaWRhdG9yLmpzIiwic2NvcGVkUXVlcnlTZWxlY3RvclNoaW0uanMiLCJkb21QYXJzZXIuanMiLCJib290c3RyYXAuanMiLCJ2YWxpZGF0b3JzLmpzIiwibWVzc2FnZXMuanMiLCJkb20taGVscGVyLmpzIiwiZm9ybS1jb25maWd1cmF0b3IuanMiLCJ2YWxpZGF0b3IuanMiLCJlcnJvci1yZW5kZXJlci5qcyIsIm1haW4uanMiXSwibmFtZXMiOlsic29Gb3JtVmFsaWRhdG9yIiwiZm9ybUVsZW1lbnQiLCJmb3JtRWxlbWVudHMiLCJzb2ZvdmEiLCJkb21IZWxwZXIiLCJnZXRFbGVtZW50RnJvbVZhcmlvdXMiLCJjb25maWd1cmF0b3IiLCJmb3JtQ29uZmlndXJhdG9yIiwibmV3Rm9ybSIsInZhbGlkYXRlIiwidmFsaWRhdG9yIiwiJCRwYXJlbnQiLCJjb25maWciLCJmb3JtcyIsInB1c2giLCJvdmVycmlkZU5vZGVNZXRob2QiLCJwcm90b3R5cGUiLCJtZXRob2ROYW1lIiwib2xkTWV0aG9kIiwicXVlcnkiLCJub2RlTGlzdCIsImdhdmVJZCIsImdhdmVDb250YWluZXIiLCJtYXRjaCIsInNjb3BlUkUiLCJyZXBsYWNlIiwidGhpcyIsInBhcmVudE5vZGUiLCJjb250YWluZXIiLCJhcHBlbmRDaGlsZCIsImlkIiwiRGF0ZSIsImdldFRpbWUiLCJjYWxsIiwicmVtb3ZlQ2hpbGQiLCJIVE1MRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJFcnJvciIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImUiLCJET01QYXJzZXIiLCJwcm90byIsIm5hdGl2ZVBhcnNlIiwicGFyc2VGcm9tU3RyaW5nIiwiZXgiLCJtYXJrdXAiLCJ0eXBlIiwidGVzdCIsImRvYyIsImltcGxlbWVudGF0aW9uIiwiY3JlYXRlSFRNTERvY3VtZW50IiwidG9Mb3dlckNhc2UiLCJpbmRleE9mIiwiZG9jdW1lbnRFbGVtZW50IiwiaW5uZXJIVE1MIiwiYm9keSIsImFwcGx5IiwiYXJndW1lbnRzIiwidmFsaWRhdG9ycyIsImdldE1lc3NhZ2VGcm9tQ29uZmlnIiwic3BsaXRDb2RlIiwibWVzc2FnZXMiLCJjdXN0b21NZXNzYWdlcyIsInZhbHVlVG9DaGVjayIsImN1c3RvbVZhbHVlVG9DaGVjayIsImxlbmd0aCIsInNsaWNlIiwibWVzc2FnZSIsImNvZGUiLCJzcGxpdCIsIiQkbWVzc2FnZXMiLCIkJGN1c3RvbU1lc3NhZ2VzIiwicG9wdWxhdGVkTWVzc2FnZSIsImEiLCJpblJhbmdlIiwidmFsIiwiaXNOYU4iLCJOYU4iLCJtaW5DaGVjayIsIm1pbiIsIm1heENoZWNrIiwibWF4IiwicnVuVmFsaWRhdG9yIiwibmFtZSIsInZhbHVlIiwiZXJyIiwidGV4dCIsInJlcXVpcmVkIiwicmVzdWx0IiwicGFyc2VGbG9hdCIsInJ1biIsImxvdyIsImhpZ2giLCJuYW4iLCJlbGVtZW50IiwiQXJyYXkiLCJpc0FycmF5IiwidGVtcGxhdGUiLCJhdHRyTmFtZSIsIiQkdGVtcGxhdGVDb25maWciLCJlcnJvck1lc3NhZ2VzIiwiYWRkUnVsZSIsInNlbGVjdG9yIiwiJCRydWxlcyIsIml0ZXJhdGVSdWxlcyIsImZ1bmMiLCJrZXlzIiwiT2JqZWN0IiwiaSIsImN1clJ1bGUiLCJ0ZW1wbGF0ZURlZmF1bHRzIiwiZXJyb3JUZW1wbGF0ZSIsIiQkaXRlcmF0ZVJ1bGVzIiwicnVsZSIsInJ1blZhbGlkYXRpb24iLCJlcnJvcnMiLCJ2YWxpZGF0ZUVsZW1lbnRzIiwiZWxlbWVudHMiLCJyZXN1bHRzIiwiZXJyb3JSZW5kZXJlciIsImRpc3BsYXlFcnJvcnMiLCJjbGVhckVycm9ycyIsInZhbGlkYXRlRm9ybSIsImZvcm1OYW1lIiwidmFsaWRhdGVBbGwiLCJqIiwidmFsaWRhdGVFbGVtZW50c0luRm9ybSIsImFsbCIsImZvcm0iLCJnZXRFcnJvcnNTdHJpbmciLCJ0ZW1wbGF0ZUNvbmZpZyIsInN0cmluZyIsInJlZHVjZSIsIm9sZCIsIm5ld1ZhbCIsIm5ld1RleHQiLCJyZW1vdmVPbGRFbGVtZW50cyIsInJlbW92ZSIsInJlcGxhY2VEb21FbGVtZW50IiwiZGV0YWlscyIsInBhcmVudCIsImluc2VydEJlZm9yZSIsImNoaWxkcmVuIiwiaW5kZXgiLCJvbGREaXNwbGF5Iiwic3R5bGUiLCJkaXNwbGF5IiwiYWRkRWxlbWVudHNUb0RvbSIsInRlbXBsYXRlRWxlbWVudHMiLCJuZXdFbGVtZW50cyIsIm5ld0VsZW1lbnQiLCJwb3B1bGF0ZUVycm9yRWxlbWVudCIsInRlbXBsYXRlU3RyaW5nIiwiZG9tUGFyc2VyIiwidGVtcGxhdGVQYXJlbnQiLCJmaXJzdENoaWxkIiwiY2hpbGROb2RlcyIsImVsZW1lbnRQbGFjZWhvbGRlciIsInF1ZXJ5U2VsZWN0b3IiLCJwYXJlbnRFbGVtZW50IiwiZm9ybUIiLCJhZGRFdmVudExpc3RlbmVyIiwiY29uc29sZSIsImxvZyJdLCJtYXBwaW5ncyI6IkFBT0EsUUFBQUEsaUJBQUFDLEdBQ0EsR0FBQUMsR0FBQUMsT0FBQUMsVUFBQUMsc0JBQUFKLEdBQ0FLLEVBQUEsR0FBQUgsUUFBQUksaUJBRUFDLElBU0EsT0FQQUEsR0FBQUMsU0FBQU4sT0FBQU8sVUFBQVIsRUFBQUksR0FFQUUsRUFBQUcsU0FBQVQsRUFDQU0sRUFBQUksT0FBQU4sRUFFQUgsT0FBQVUsTUFBQUMsS0FBQU4sR0FFQUEsR0NwQkEsV0FtQkEsUUFBQU8sR0FBQUMsRUFBQUMsR0FFQSxHQUFBQyxHQUFBRixFQUFBQyxFQUdBRCxHQUFBQyxHQUFBLFNBQUFFLEdBQ0EsR0FBQUMsR0FDQUMsR0FBQSxFQUNBQyxHQUFBLENBRUEsSUFBQUgsRUFBQUksTUFBQUMsR0FBQSxDQUVBTCxFQUFBQSxFQUFBTSxRQUFBRCxFQUFBLElBRUFFLEtBQUFDLGFBRUFDLEVBQUFDLFlBQUFILE1BQ0FKLEdBQUEsRUFHQSxJQUFBSyxHQUFBRCxLQUFBQyxVQXFCQSxPQW5CQUQsTUFBQUksS0FFQUosS0FBQUksR0FBQSwyQkFBQSxHQUFBQyxPQUFBQyxVQUNBWCxHQUFBLEdBSUFELEVBQUFGLEVBQUFlLEtB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LCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFkZHMgZm9ybSB2YWxpZGF0aW9uIHRvIGNoaWxkcmVuIG9mIGdpdmVuIGRvbSBlbGVtZW50XG4gKlxuICogUmVxdWlyZXMgYSBkb20gZWxlbWVudCBvYmplY3Qgb3IgYSBzdHJpbmcgY2xhc3Mgb3IgaWQgc2VsZWN0b3IuXG4gKiBAcGFyYW0ge05vZGUgfCBzdHJpbmcgfCBOb2RlTGlzdCB8IEFycmF5IDxzdHJpbmc+fSBmb3JtRWxlbWVudFxuICogQHJldHVybnMge3t9fVxuICovXG5mdW5jdGlvbiBzb0Zvcm1WYWxpZGF0b3IoZm9ybUVsZW1lbnQpIHtcbiAgICB2YXIgZm9ybUVsZW1lbnRzID0gc29mb3ZhLmRvbUhlbHBlci5nZXRFbGVtZW50RnJvbVZhcmlvdXMoZm9ybUVsZW1lbnQpO1xuICAgIHZhciBjb25maWd1cmF0b3IgPSBuZXcgc29mb3ZhLmZvcm1Db25maWd1cmF0b3IoKTtcblxuICAgIHZhciBuZXdGb3JtID0ge307XG5cbiAgICBuZXdGb3JtLnZhbGlkYXRlID0gc29mb3ZhLnZhbGlkYXRvcihmb3JtRWxlbWVudHMsIGNvbmZpZ3VyYXRvcik7XG5cbiAgICBuZXdGb3JtLiQkcGFyZW50ID0gZm9ybUVsZW1lbnRzO1xuICAgIG5ld0Zvcm0uY29uZmlnID0gY29uZmlndXJhdG9yO1xuXG4gICAgc29mb3ZhLmZvcm1zLnB1c2gobmV3Rm9ybSk7XG5cbiAgICByZXR1cm4gbmV3Rm9ybTtcbn0iLCIoZnVuY3Rpb24oKSB7XG4gICAgaWYgKCFIVE1MRWxlbWVudC5wcm90b3R5cGUucXVlcnlTZWxlY3RvckFsbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Jvb3RlZFF1ZXJ5U2VsZWN0b3JBbGw6IFRoaXMgcG9seWZpbGwgY2FuIG9ubHkgYmUgdXNlZCB3aXRoIGJyb3dzZXJzIHRoYXQgc3VwcG9ydCBxdWVyeVNlbGVjdG9yQWxsJyk7XG4gICAgfVxuXG4gICAgLy8gQSB0ZW1wb3JhcnkgZWxlbWVudCB0byBxdWVyeSBhZ2FpbnN0IGZvciBlbGVtZW50cyBub3QgY3VycmVudGx5IGluIHRoZSBET01cbiAgICAvLyBXZSdsbCBhbHNvIHVzZSB0aGlzIGVsZW1lbnQgdG8gdGVzdCBmb3IgOnNjb3BlIHN1cHBvcnRcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cbiAgICAvLyBDaGVjayBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyA6c2NvcGVcbiAgICB0cnkge1xuICAgICAgICAvLyBCcm93c2VyIHN1cHBvcnRzIDpzY29wZSwgZG8gbm90aGluZ1xuICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnOnNjb3BlIConKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gTWF0Y2ggdXNhZ2Ugb2Ygc2NvcGVcbiAgICAgICAgdmFyIHNjb3BlUkUgPSAvXlxccyo6c2NvcGUvZ2k7XG5cbiAgICAgICAgLy8gT3ZlcnJpZGVzXG4gICAgICAgIGZ1bmN0aW9uIG92ZXJyaWRlTm9kZU1ldGhvZChwcm90b3R5cGUsIG1ldGhvZE5hbWUpIHtcbiAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBvbGQgbWV0aG9kIGZvciB1c2UgbGF0ZXJcbiAgICAgICAgICAgIHZhciBvbGRNZXRob2QgPSBwcm90b3R5cGVbbWV0aG9kTmFtZV07XG5cbiAgICAgICAgICAgIC8vIE92ZXJyaWRlIHRoZSBtZXRob2RcbiAgICAgICAgICAgIHByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgdmFyIG5vZGVMaXN0LFxuICAgICAgICAgICAgICAgICAgICBnYXZlSWQgPSBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZ2F2ZUNvbnRhaW5lciA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgaWYgKHF1ZXJ5Lm1hdGNoKHNjb3BlUkUpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSA6c2NvcGVcbiAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSBxdWVyeS5yZXBsYWNlKHNjb3BlUkUsICcnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRvIHRlbXBvcmFyeSBjb250YWluZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdmVDb250YWluZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudE5vZGUgPSB0aGlzLnBhcmVudE5vZGU7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBHaXZlIHRlbXBvcmFyeSBJRFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pZCA9ICdyb290ZWRRdWVyeVNlbGVjdG9yX2lkXycrKG5ldyBEYXRlKCkpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdmVJZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBGaW5kIGVsZW1lbnRzIGFnYWluc3QgcGFyZW50IG5vZGVcbiAgICAgICAgICAgICAgICAgICAgbm9kZUxpc3QgPSBvbGRNZXRob2QuY2FsbChwYXJlbnROb2RlLCAnIycrdGhpcy5pZCsnICcrcXVlcnkpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBJRFxuICAgICAgICAgICAgICAgICAgICBpZiAoZ2F2ZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlkID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZnJvbSB0ZW1wb3JhcnkgY29udGFpbmVyXG4gICAgICAgICAgICAgICAgICAgIGlmIChnYXZlQ29udGFpbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZUxpc3Q7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBObyBpbW1lZGlhdGUgY2hpbGQgc2VsZWN0b3IgdXNlZFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2xkTWV0aG9kLmNhbGwodGhpcywgcXVlcnkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBCcm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCA6c2NvcGUsIGFkZCBwb2x5ZmlsbFxuICAgICAgICBvdmVycmlkZU5vZGVNZXRob2QoSFRNTEVsZW1lbnQucHJvdG90eXBlLCAncXVlcnlTZWxlY3RvcicpO1xuICAgICAgICBvdmVycmlkZU5vZGVNZXRob2QoSFRNTEVsZW1lbnQucHJvdG90eXBlLCAncXVlcnlTZWxlY3RvckFsbCcpO1xuICAgIH1cbn0oKSk7IiwiKGZ1bmN0aW9uIChET01QYXJzZXIpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIHZhclxuICAgICAgICBwcm90byA9IERPTVBhcnNlci5wcm90b3R5cGVcbiAgICAgICAgLCBuYXRpdmVQYXJzZSA9IHByb3RvLnBhcnNlRnJvbVN0cmluZ1xuICAgICAgICA7XG5cbiAgICAvLyBGaXJlZm94L09wZXJhL0lFIHRocm93IGVycm9ycyBvbiB1bnN1cHBvcnRlZCB0eXBlc1xuICAgIHRyeSB7XG4gICAgICAgIC8vIFdlYktpdCByZXR1cm5zIG51bGwgb24gdW5zdXBwb3J0ZWQgdHlwZXNcbiAgICAgICAgaWYgKChuZXcgRE9NUGFyc2VyKCkpLnBhcnNlRnJvbVN0cmluZyhcIlwiLCBcInRleHQvaHRtbFwiKSkge1xuICAgICAgICAgICAgLy8gdGV4dC9odG1sIHBhcnNpbmcgaXMgbmF0aXZlbHkgc3VwcG9ydGVkXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChleCkge1xuICAgIH1cblxuICAgIHByb3RvLnBhcnNlRnJvbVN0cmluZyA9IGZ1bmN0aW9uIChtYXJrdXAsIHR5cGUpIHtcbiAgICAgICAgaWYgKC9eXFxzKnRleHRcXC9odG1sXFxzKig/Ojt8JCkvaS50ZXN0KHR5cGUpKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICBkb2MgPSBkb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVIVE1MRG9jdW1lbnQoXCJcIilcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICBpZiAobWFya3VwLnRvTG93ZXJDYXNlKCkuaW5kZXhPZignPCFkb2N0eXBlJykgPiAtMSkge1xuICAgICAgICAgICAgICAgIGRvYy5kb2N1bWVudEVsZW1lbnQuaW5uZXJIVE1MID0gbWFya3VwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZG9jLmJvZHkuaW5uZXJIVE1MID0gbWFya3VwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRvYztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBuYXRpdmVQYXJzZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgfTtcbn0oRE9NUGFyc2VyKSk7IiwidmFyIHNvZm92YSA9IHtcbiAgICBmb3JtczogW11cbn07XG4iLCJzb2ZvdmEudmFsaWRhdG9ycyA9IChmdW5jdGlvbiAoY29uZmlndXJhdG9yKSB7XG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgYSBtZXNzYWdlIGZyb20gdGhlIGRlZmF1bHQgY29uZmlnXG4gICAgICogQHBhcmFtIHNwbGl0Q29kZVxuICAgICAqIEBwYXJhbSBhcnJheVxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldE1lc3NhZ2VGcm9tQ29uZmlnKHNwbGl0Q29kZSwgbWVzc2FnZXMsIGN1c3RvbU1lc3NhZ2VzKSB7XG4gICAgICAgIHZhciB2YWx1ZVRvQ2hlY2sgPSBtZXNzYWdlc1tzcGxpdENvZGVbMF1dO1xuICAgICAgICBpZiAodHlwZW9mIGN1c3RvbU1lc3NhZ2VzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdmFyIGN1c3RvbVZhbHVlVG9DaGVjayA9IGN1c3RvbU1lc3NhZ2VzW3NwbGl0Q29kZVswXV07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc3BsaXRDb2RlLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIGN1c3RvbVZhbHVlVG9DaGVjayB8fCB2YWx1ZVRvQ2hlY2s7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlVG9DaGVjayAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRNZXNzYWdlRnJvbUNvbmZpZyhzcGxpdENvZGUuc2xpY2UoMSksIHZhbHVlVG9DaGVjaywgY3VzdG9tVmFsdWVUb0NoZWNrKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2YWx1ZVRvQ2hlY2s7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIGFuIGVycm9yIG1lc3NhZ2UgZnJvbSBlcnJvciBjb2RlXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWVzc2FnZShjb2RlLCBjb25maWcpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjb2RlID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNwbGl0Q29kZSA9IGNvZGUuc3BsaXQoXCIuXCIpO1xuICAgICAgICB2YXIgbWVzc2FnZXMgPSBzb2ZvdmEudmFsaWRhdG9ycy4kJG1lc3NhZ2VzO1xuICAgICAgICB2YXIgY3VzdG9tTWVzc2FnZXMgPSBjb25maWd1cmF0b3IuJCRjdXN0b21NZXNzYWdlcztcblxuICAgICAgICB2YXIgbWVzc2FnZSA9IGdldE1lc3NhZ2VGcm9tQ29uZmlnKHNwbGl0Q29kZSwgbWVzc2FnZXMsIGN1c3RvbU1lc3NhZ2VzKTtcblxuICAgICAgICAvL1JlcGxhY2UgYW55IHBsYWNlaG9sZGVycyBpbiB0aGUgdGV4dCB3aXRoIHZhbHVlcyBpbiB0aGUgY29uZmlnXG4gICAgICAgIHZhciBwb3B1bGF0ZWRNZXNzYWdlID0gbWVzc2FnZS5yZXBsYWNlKC9cXCQoLio/KVxcJC9nLCBmdW5jdGlvbiAoYSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ1thLnNsaWNlKDEsIGEubGVuZ3RoIC0gMSldO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gW3BvcHVsYXRlZE1lc3NhZ2UsIGNvZGVdO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBhIHZhbHVlIGlzIGluIGEgY2VydGFpbiByYW5nZSBhbmQgcmV0dXJucyAtMSBpZiB0b28gbG93IDEgaWYgdG9vIGhpZ2ggYW5kIDAgaWYgaW4gcmFuZ2VcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGNvbmZpZ1xuICAgICAqIEByZXR1cm5zIHtpbnR9XG4gICAgICovXG4gICAgZnVuY3Rpb24gaW5SYW5nZSh2YWwsIGNvbmZpZykge1xuICAgICAgICBpZiAoaXNOYU4odmFsKSkge1xuICAgICAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBtaW5DaGVjayA9ICh0eXBlb2YgY29uZmlnLm1pbiA9PT0gXCJ1bmRlZmluZWRcIiB8fCB2YWwgPj0gY29uZmlnLm1pbik7XG4gICAgICAgIHZhciBtYXhDaGVjayA9ICh0eXBlb2YgY29uZmlnLm1heCA9PT0gXCJ1bmRlZmluZWRcIiB8fCB2YWwgPD0gY29uZmlnLm1heCk7XG5cbiAgICAgICAgaWYgKCFtaW5DaGVjaykge1xuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbWF4Q2hlY2spIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29sbGVjdGlvbiBvZiBhbGwgdmFsaWRhdG9yIGZ1bmN0aW9uc1xuICAgICAqIEB0eXBlIHt7cmVxdWlyZWQ6IHZhbGlkYXRvcnMucmVxdWlyZWQsIGxlbmd0aDogdmFsaWRhdG9ycy5sZW5ndGh9fVxuICAgICAqL1xuICAgIHZhciB2YWxpZGF0b3JzID0ge1xuICAgICAgICByZXF1aXJlZDogZnVuY3Rpb24gKGNvbmZpZywgdmFsKSB7XG4gICAgICAgICAgICBpZiAoY29uZmlnID09PSB0cnVlICYmIHZhbC5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlKCdyZXF1aXJlZCcsIGNvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGxlbmd0aDogZnVuY3Rpb24gKGNvbmZpZywgdmFsKSB7XG4gICAgICAgICAgICB2YXIgY29kZSwgcmVzdWx0ID0gaW5SYW5nZSh2YWwubGVuZ3RoLCBjb25maWcpO1xuXG4gICAgICAgICAgICBpZiAocmVzdWx0ID09PSAtMSkge1xuICAgICAgICAgICAgICAgIGNvZGUgPSBcImxlbmd0aC5sb3dcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjb2RlID0gXCJsZW5ndGguaGlnaFwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbWVzc2FnZShjb2RlLCBjb25maWcpO1xuICAgICAgICB9LFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKGNvbmZpZywgdmFsKSB7XG4gICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KHZhbCk7XG4gICAgICAgICAgICB2YXIgY29kZSwgcmVzdWx0ID0gaW5SYW5nZSh2YWwsIGNvbmZpZyk7XG5cbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgY29kZSA9IFwidmFsdWUubG93XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzdWx0ID09PSAxKSB7XG4gICAgICAgICAgICAgICAgY29kZSA9IFwidmFsdWUuaGlnaFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzTmFOKHJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICBjb2RlID0gXCJ2YWx1ZS5uYW5cIlxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbWVzc2FnZShjb2RlLCBjb25maWcpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFJ1biB2YWxpZGF0aW9uIGZ1bmN0aW9uIG9uIGEgdmFsdWVcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gY29uZmlnXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAgICAgKiBAcGFyYW0gdmFsdWVcbiAgICAgKiBAcmV0dXJuIHtib29sZWFuIHwgRXJyb3IgfCBvYmplY3R9XG4gICAgICovXG4gICAgZnVuY3Rpb24gcnVuVmFsaWRhdG9yKGNvbmZpZywgbmFtZSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWxpZGF0b3JzW25hbWVdICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICB2YXIgZXJyID0gdmFsaWRhdG9yc1tuYW1lXShjb25maWcsIHZhbHVlKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZXJyID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge3RleHQ6IGVyclswXSwgY29kZTogZXJyWzFdfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgRXJyb3IoXCJWYWxpZGF0b3IgZG9lcyBub3QgZXhpc3RcIik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcnVuOiBydW5WYWxpZGF0b3JcbiAgICB9O1xufSk7Iiwic29mb3ZhLnZhbGlkYXRvcnMuJCRtZXNzYWdlcyA9IHtcbiAgICBsZW5ndGg6IHtcbiAgICAgICAgbG93OiBcIk1pbmltdW0gbGVuZ3RoIGlzICRtaW4kXCIsXG4gICAgICAgIGhpZ2g6IFwiTWF4aW11bSBsZW5ndGggaXMgJG1heCRcIlxuICAgIH0sXG4gICAgdmFsdWU6IHtcbiAgICAgICAgbG93OiBcIk1pbmltdW0gdmFsdWUgaXMgJG1pbiRcIixcbiAgICAgICAgaGlnaDogXCJNYXhpbXVtIHZhbHVlIGlzICRtYXgkXCIsXG4gICAgICAgIG5hbjogXCJWYWx1ZSBtdXN0IGJlIGEgbnVtYmVyIGJldHdlZW4gJG1pbiQgYW5kICRtYXgkXCJcbiAgICB9LFxuICAgIHJlcXVpcmVkOiBcIlZhbHVlIGlzIHJlcXVpcmVkXCJcbn07Iiwic29mb3ZhLmRvbUhlbHBlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtEb21FbGVtZW50IHwgc3RyaW5nIHwgQXJyYXkgPERvbUVsZW1lbnQ+IHwgQXJyYXkgPHN0cmluZz59IGVsZW1lbnRcbiAgICAgKiBAcmV0dXJucyB7RG9tRWxlbWVudCB8IEFycmF5IDxEb21FbGVtZW50Pn1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRFbGVtZW50RnJvbVZhcmlvdXMoZWxlbWVudCkge1xuICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09IFwib2JqZWN0XCIgfHwgQXJyYXkuaXNBcnJheShlbGVtZW50KSkge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGVsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0RWxlbWVudEZyb21WYXJpb3VzOiBnZXRFbGVtZW50RnJvbVZhcmlvdXNcbiAgICB9O1xufSgpKTsiLCJzb2ZvdmEuZm9ybUNvbmZpZ3VyYXRvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIHRlbXBsYXRlIG9wdGlvbnNcbiAgICAgKiBAcGFyYW0gY29uZmlnXG4gICAgICovXG4gICAgZnVuY3Rpb24gdGVtcGxhdGUoY29uZmlnKSB7XG4gICAgICAgIGZvciAodmFyIGF0dHJOYW1lIGluIGNvbmZpZykge1xuICAgICAgICAgICAgdGhpcy4kJHRlbXBsYXRlQ29uZmlnW2F0dHJOYW1lXSA9IGNvbmZpZ1thdHRyTmFtZV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXR1cCBjdXN0b20gZXJyb3IgbWVzc2FnZXNcbiAgICAgKiBAcGFyYW0gY29uZmlnXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXJyb3JNZXNzYWdlcyhjb25maWcpIHtcbiAgICAgICAgdGhpcy4kJGN1c3RvbU1lc3NhZ2VzID0gY29uZmlnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCBhIHZhbGlkYXRpb24gcnVsZSB0byBhIGZvcm0gZWxlbWVudFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzZWxlY3RvclxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBjb25maWdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhZGRSdWxlKHNlbGVjdG9yLCBjb25maWcpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLiQkcnVsZXNbc2VsZWN0b3JdID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICB0aGlzLiQkcnVsZXNbc2VsZWN0b3JdID0ge307XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLiQkcnVsZXNbc2VsZWN0b3JdLmNvbmZpZyA9IGNvbmZpZztcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb29wIHRocm91Z2ggYWxsIHJ1bGVzIGFuZCBjYWxsYmFjayBvbiBlYWNoXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZnVuY1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGl0ZXJhdGVSdWxlcyhmdW5jKSB7XG4gICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXModGhpcy4kJHJ1bGVzKTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChrZXlzW2ldLnNsaWNlKDAsIDIpID09PSBcIiQkXCIpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjdXJSdWxlID0gdGhpcy4kJHJ1bGVzW2tleXNbaV1dO1xuXG4gICAgICAgICAgICBmdW5jKGN1clJ1bGUsIGtleXNbaV0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHRlbXBsYXRlRGVmYXVsdHMgPSB7XG4gICAgICAgIHR5cGU6IFwiZGVmYXVsdFwiLFxuICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJzby1mb3JtLWVycm9yc1wiPiRlbGVtZW50JCAkZXJyb3JzJDwvZGl2PicsXG4gICAgICAgIGVycm9yVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwic28tZm9ybS1lcnJvclwiPiRtZXNzYWdlJDwvZGl2PidcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgJCRydWxlczoge30sXG4gICAgICAgICQkdGVtcGxhdGVDb25maWc6IHRlbXBsYXRlRGVmYXVsdHMsXG4gICAgICAgICQkaXRlcmF0ZVJ1bGVzOiBpdGVyYXRlUnVsZXMsXG4gICAgICAgIHRlbXBsYXRlOiB0ZW1wbGF0ZSxcbiAgICAgICAgZXJyb3JNZXNzYWdlczogZXJyb3JNZXNzYWdlcyxcbiAgICAgICAgcnVsZTogYWRkUnVsZVxuICAgIH07XG59OyIsInNvZm92YS52YWxpZGF0b3IgPSAoZnVuY3Rpb24gKGZvcm1FbGVtZW50cywgY29uZmlndXJhdG9yKSB7XG4gICAgdmFyIHZhbGlkYXRvcnMgPSB7fTtcblxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlIGEgdmFsdWUgYWdhaW5zdCBhIHZhbGlkYXRpb24gY29uZmlnXG4gICAgICogQHBhcmFtIGNvbmZpZ1xuICAgICAqIEBwYXJhbSB2YWx1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJ1blZhbGlkYXRpb24oY29uZmlnLCB2YWx1ZSkge1xuICAgICAgICB2YXIgZXJyb3JzID0gW107XG5cbiAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhjb25maWcpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB2YWxpZGF0b3JzLnJ1bihjb25maWdba2V5c1tpXV0sIGtleXNbaV0sIHZhbHVlKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBlcnJvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleXNbaV0sXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3VsdFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVycm9ycztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSdW4gdmFsaWRhdG9yIGZ1bmN0aW9uIG9uIGFsbCBlbGVtZW50c1xuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBydWxlXG4gICAgICogQHBhcmFtIHtOb2RlTGlzdH0gZWxlbWVudHNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB2YWxpZGF0ZUVsZW1lbnRzKHJ1bGUsIGVsZW1lbnRzKSB7XG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGVycm9ycyA9IHJ1blZhbGlkYXRpb24ocnVsZS5jb25maWcsIGVsZW1lbnRzW2ldLnZhbHVlKTtcbiAgICAgICAgICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdHNbaV0gPSBlcnJvcnM7XG4gICAgICAgICAgICAgICAgc29mb3ZhLmVycm9yUmVuZGVyZXIuZGlzcGxheUVycm9ycyhlbGVtZW50c1tpXSwgcnVsZSwgZXJyb3JzLCBjb25maWd1cmF0b3IuJCR0ZW1wbGF0ZUNvbmZpZylcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc29mb3ZhLmVycm9yUmVuZGVyZXIuY2xlYXJFcnJvcnMoY29uZmlndXJhdG9yLiQkdGVtcGxhdGVDb25maWcsIGVsZW1lbnRzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHZhbGlkYXRlRm9ybShmb3JtTmFtZSkge1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlIGFsbCBmaWVsZHMgaW4gZm9ybVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHZhbGlkYXRlQWxsKCkge1xuICAgICAgICB2YWxpZGF0b3JzID0gc29mb3ZhLnZhbGlkYXRvcnMoY29uZmlndXJhdG9yKTtcblxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGZvcm1FbGVtZW50cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgdmFyIGZvcm1FbGVtZW50ID0gZm9ybUVsZW1lbnRzW2pdO1xuICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSB2YWxpZGF0ZUVsZW1lbnRzSW5Gb3JtKGZvcm1FbGVtZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHZhbGlkYXRlRWxlbWVudHNJbkZvcm0oZm9ybUVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHJlc3VsdHMgPSB7fTtcblxuICAgICAgICBjb25maWd1cmF0b3IuJCRpdGVyYXRlUnVsZXMoZnVuY3Rpb24gKHJ1bGUsIHNlbGVjdG9yKSB7XG4gICAgICAgICAgICAvL25vaW5zcGVjdGlvbiBKU1JlZmVyZW5jaW5nTXV0YWJsZVZhcmlhYmxlRnJvbUNsb3N1cmVcbiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCI6c2NvcGUgXCIgKyBzZWxlY3Rvcik7XG5cbiAgICAgICAgICAgIHZhciBlcnJvcnMgPSB2YWxpZGF0ZUVsZW1lbnRzKHJ1bGUsIGVsZW1lbnRzKTtcblxuICAgICAgICAgICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0c1tzZWxlY3Rvcl0gPSBlcnJvcnM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGFsbDogdmFsaWRhdGVBbGwsXG4gICAgICAgIGZvcm06IHZhbGlkYXRlRm9ybVxuICAgIH07XG59KTsiLCJzb2ZvdmEuZXJyb3JSZW5kZXJlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBET00gZWxlbWVudCB0aGF0IGRpc3BsYXkgZXJyb3IgbWVzc2FnZXNcbiAgICAgKiBAcGFyYW0gdGVtcGxhdGVDb25maWdcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBlcnJvcnNcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0RXJyb3JzU3RyaW5nKHRlbXBsYXRlQ29uZmlnLCBlcnJvcnMpIHtcbiAgICAgICAgdmFyIHN0cmluZztcblxuICAgICAgICBzdHJpbmcgPSBlcnJvcnMucmVkdWNlKGZ1bmN0aW9uIChvbGQsIG5ld1ZhbCkge1xuICAgICAgICAgICAgdmFyIG5ld1RleHQgPSB0ZW1wbGF0ZUNvbmZpZy5lcnJvclRlbXBsYXRlXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoXCIkbWVzc2FnZSRcIiwgbmV3VmFsLm1lc3NhZ2UudGV4dClcbiAgICAgICAgICAgICAgICAucmVwbGFjZShcIiRjb2RlJFwiLCBuZXdWYWwubWVzc2FnZS5jb2RlKTtcblxuICAgICAgICAgICAgcmV0dXJuIG9sZCArIG5ld1RleHQ7XG4gICAgICAgIH0sIFwiXCIpO1xuXG4gICAgICAgIHJldHVybiBzdHJpbmc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIG9sZCBlcnJvciBtZXNzYWdlIGVsZW1lbnRzXG4gICAgICogQHBhcmFtIGVsZW1lbnRzXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVtb3ZlT2xkRWxlbWVudHMoZWxlbWVudHMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50cyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGVsZW1lbnRzW2ldLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVwbGFjZURvbUVsZW1lbnQodGVtcGxhdGVDb25maWcsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB0ZW1wbGF0ZUNvbmZpZy5kZXRhaWxzLnBhcmVudFxuICAgICAgICAgICAgLmluc2VydEJlZm9yZShcbiAgICAgICAgICAgICAgICBlbGVtZW50LFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlQ29uZmlnLmRldGFpbHMucGFyZW50LmNoaWxkcmVuW3RlbXBsYXRlQ29uZmlnLmRldGFpbHMuaW5kZXhdXG4gICAgICAgICAgICApO1xuXG4gICAgICAgIHZhciBvbGREaXNwbGF5ID0gZWxlbWVudC5zdHlsZS5kaXNwbGF5O1xuXG4gICAgICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gb2xkRGlzcGxheTtcblxuICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQgYWxsIHRoZSB0ZW1wbGF0ZSBlbGVtZW50cyB0byB0aGUgRE9NIHVzaW5nIHRoZSB0ZW1wbGF0ZUNvbmZpZy5kZXRhaWxzXG4gICAgICogYXMgYSByZWZlcmVuY2VcbiAgICAgKiBAcGFyYW0gdGVtcGxhdGVFbGVtZW50c1xuICAgICAqIEBwYXJhbSB0ZW1wbGF0ZUNvbmZpZ1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFkZEVsZW1lbnRzVG9Eb20odGVtcGxhdGVFbGVtZW50cywgdGVtcGxhdGVDb25maWcpIHtcbiAgICAgICAgdmFyIG5ld0VsZW1lbnRzID0gW107XG5cbiAgICAgICAgd2hpbGUgKHR5cGVvZiB0ZW1wbGF0ZUVsZW1lbnRzW3RlbXBsYXRlRWxlbWVudHMubGVuZ3RoIC0gMV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB2YXIgbmV3RWxlbWVudCA9XG4gICAgICAgICAgICAgICAgcmVwbGFjZURvbUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlQ29uZmlnLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZUVsZW1lbnRzW3RlbXBsYXRlRWxlbWVudHMubGVuZ3RoIC0gMV1cbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBuZXdFbGVtZW50cy5wdXNoKG5ld0VsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGVtcGxhdGVDb25maWcuZWxlbWVudHMgPSBuZXdFbGVtZW50cztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQb3B1bGF0ZSB0aGUgdGVtcGxhdGUgd2l0aCBlcnJvciBtZXNzYWdlcyB1c2luZyB0aGUgcGxhY2Vob2xkZXJzXG4gICAgICogQHBhcmFtIHRlbXBsYXRlQ29uZmlnXG4gICAgICogQHBhcmFtIGVsZW1lbnRcbiAgICAgKiBAcGFyYW0gZXJyb3JzXG4gICAgICovXG4gICAgZnVuY3Rpb24gcG9wdWxhdGVFcnJvckVsZW1lbnQodGVtcGxhdGVDb25maWcsIGVsZW1lbnQsIGVycm9ycykge1xuICAgICAgICByZW1vdmVPbGRFbGVtZW50cyh0ZW1wbGF0ZUNvbmZpZy5lbGVtZW50cyk7XG5cbiAgICAgICAgdmFyIHRlbXBsYXRlU3RyaW5nID0gdGVtcGxhdGVDb25maWcudGVtcGxhdGU7XG5cbiAgICAgICAgdGVtcGxhdGVTdHJpbmcgPSB0ZW1wbGF0ZVN0cmluZ1xuICAgICAgICAgICAgLnJlcGxhY2UoXCIkZWxlbWVudCRcIiwgXCI8ZWxlbWVudC1wbGFjZWhvbGRlcj48L2VsZW1lbnQtcGxhY2Vob2xkZXI+XCIpXG4gICAgICAgICAgICAucmVwbGFjZShcIiRlcnJvcnMkXCIsIGdldEVycm9yc1N0cmluZyh0ZW1wbGF0ZUNvbmZpZywgZXJyb3JzKSk7XG5cbiAgICAgICAgdmFyIGRvbVBhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcbiAgICAgICAgdmFyIHRlbXBsYXRlUGFyZW50ID0gZG9tUGFyc2VyLnBhcnNlRnJvbVN0cmluZyh0ZW1wbGF0ZVN0cmluZywgXCJ0ZXh0L2h0bWxcIilcbiAgICAgICAgICAgIC5maXJzdENoaWxkLmNoaWxkTm9kZXNbMV07XG5cbiAgICAgICAgdmFyIHRlbXBsYXRlRWxlbWVudHMgPSB0ZW1wbGF0ZVBhcmVudC5jaGlsZHJlbjtcblxuICAgICAgICB2YXIgZWxlbWVudFBsYWNlaG9sZGVyID0gdGVtcGxhdGVQYXJlbnQucXVlcnlTZWxlY3RvcihcImVsZW1lbnQtcGxhY2Vob2xkZXJcIik7XG5cbiAgICAgICAgZWxlbWVudFBsYWNlaG9sZGVyLnBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGVsZW1lbnQsIGVsZW1lbnRQbGFjZWhvbGRlcik7XG5cbiAgICAgICAgYWRkRWxlbWVudHNUb0RvbSh0ZW1wbGF0ZUVsZW1lbnRzLCB0ZW1wbGF0ZUNvbmZpZyk7XG5cbiAgICAgICAgZWxlbWVudFBsYWNlaG9sZGVyLnJlbW92ZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBFcnJvciBlbGVtZW50c1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsZWFyRXJyb3JzKHRlbXBsYXRlQ29uZmlnLCBlbGVtZW50KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGVtcGxhdGVDb25maWcuZGV0YWlscyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlbW92ZU9sZEVsZW1lbnRzKHRlbXBsYXRlQ29uZmlnLmVsZW1lbnRzKTtcbiAgICAgICAgZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgcmVwbGFjZURvbUVsZW1lbnQodGVtcGxhdGVDb25maWcsIGVsZW1lbnQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBlcnJvciBlbGVtZW50IGFuZCBwb3B1bGF0ZVxuICAgICAqIEBwYXJhbSBlbGVtZW50XG4gICAgICogQHBhcmFtIHJ1bGVcbiAgICAgKiBAcGFyYW0gZXJyb3JzXG4gICAgICogQHBhcmFtIHRlbXBsYXRlQ29uZmlnXG4gICAgICovXG4gICAgZnVuY3Rpb24gZGlzcGxheUVycm9ycyhlbGVtZW50LCBydWxlLCBlcnJvcnMsIHRlbXBsYXRlQ29uZmlnKSB7XG4gICAgICAgIC8vSWYgaXQncyB0aGUgZmlyc3QgdGltZSB0aGVuIHNhdmUgdGhlIHBvc2l0aW9uIGRldGFpbHMgc28gd2UgY2FuIHB1dCB0aGUgaW5wdXQgYmFja1xuICAgICAgICBpZiAodHlwZW9mIHRlbXBsYXRlQ29uZmlnLmRldGFpbHMgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZUNvbmZpZy5kZXRhaWxzID0ge1xuICAgICAgICAgICAgICAgIHBhcmVudDogZWxlbWVudC5wYXJlbnRFbGVtZW50LFxuICAgICAgICAgICAgICAgIGluZGV4OiBBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGVsZW1lbnQucGFyZW50RWxlbWVudCwgZWxlbWVudClcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBwb3B1bGF0ZUVycm9yRWxlbWVudCh0ZW1wbGF0ZUNvbmZpZywgZWxlbWVudCwgZXJyb3JzKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBkaXNwbGF5RXJyb3JzOiBkaXNwbGF5RXJyb3JzLFxuICAgICAgICBjbGVhckVycm9yczogY2xlYXJFcnJvcnNcbiAgICB9O1xufSgpKTsiLCJ2YXIgZm9ybSA9IHNvRm9ybVZhbGlkYXRvcihcIi50ZXN0LWZvcm1cIik7XG5cbmZvcm0uY29uZmlnLnJ1bGUoXCJpbnB1dFtuYW1lPXRlc3QtaW5wdXRdXCIsIHtcbiAgICB2YWx1ZToge1xuICAgICAgICBtYXg6IDEwLFxuICAgICAgICBtaW46IDVcbiAgICB9LFxuICAgIGxlbmd0aDoge1xuICAgICAgICBtaW46IDFcbiAgICB9LFxuICAgIHJlcXVpcmVkOiB0cnVlXG59KTtcblxuZm9ybS5jb25maWcuZXJyb3JNZXNzYWdlcyh7XG4gICAgdmFsdWU6IHtcbiAgICAgICAgbG93OiBcIkxvdyBsb3cgbG93XCIsXG4gICAgICAgIGhpZ2g6IFwiSGlnaCBoaWdoIGhpZ2hcIlxuICAgIH0sXG4gICAgcmVxdWlyZWQ6IFwiT29vb29vb3BzXCJcbn0pO1xuXG5mb3JtLmNvbmZpZy50ZW1wbGF0ZSh7XG4gICAgdGVtcGxhdGU6IFwiPGRpdiBjbGFzcz0nc28tZm9ybS1lcnJvcnMnPiRlbGVtZW50JCAkZXJyb3JzJDwvZGl2PlwiLFxuICAgIGVycm9yVGVtcGxhdGU6IFwiPGRpdiBjbGFzcz0nc28tZm9ybS1lcnJvcicgZGF0YS1jb2RlPSckY29kZSQnPiRtZXNzYWdlJDwvZGl2PlwiXG59KTtcblxudmFyIGZvcm1CID0gc29Gb3JtVmFsaWRhdG9yKFwiLnRlc3QtZm9ybS1iXCIpO1xuXG5mb3JtQi5jb25maWcucnVsZShcImlucHV0W25hbWU9dGVzdC1pbnB1dF1cIiwge1xuICAgIHZhbHVlOiB7XG4gICAgICAgIG1heDogMTBcbiAgICB9LFxuICAgIGxlbmd0aDoge1xuICAgICAgICBtaW46IDFcbiAgICB9LFxuICAgIHJlcXVpcmVkOiB0cnVlXG59KTtcblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImlucHV0W3R5cGU9c3VibWl0XVwiKS5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgZm9ybS52YWxpZGF0ZS5hbGwoKTtcbn0pO1xuXG5jb25zb2xlLmxvZyhmb3JtKTtcbmNvbnNvbGUubG9nKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
